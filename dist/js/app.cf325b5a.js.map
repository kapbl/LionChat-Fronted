{"version":3,"file":"js/app.cf325b5a.js","mappings":"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","sources":["webpack://chat-web/./src/App.vue","webpack://chat-web/./src/App.vue?7ccd","webpack://chat-web/./src/components/chat2/state.js","webpack://chat-web/./src/components/Toast.vue","webpack://chat-web/./src/components/Toast.vue?44c7","webpack://chat-web/./src/components/chat2/LeftLayout.vue","webpack://chat-web/./src/components/chat2/LeftLayout.vue?bb99","webpack://chat-web/./src/utils/format.js","webpack://chat-web/./src/components/chat2/emoji.js","webpack://chat-web/./src/components/chat2/websocket.js","webpack://chat-web/./src/components/chat2/WebRTCVoiceCall.vue","webpack://chat-web/./src/components/chat2/WebRTCVoiceCall.vue?eb92","webpack://chat-web/./src/components/chat2/WebRTCVideoCall.vue","webpack://chat-web/./src/components/chat2/WebRTCVideoCall.vue?4b5c","webpack://chat-web/./src/components/chat2/ackManager.js","webpack://chat-web/./src/components/chat2/MessageLayout.vue","webpack://chat-web/./src/components/chat2/MessageLayout.vue?6409","webpack://chat-web/./src/Chat.vue","webpack://chat-web/./src/Chat.vue?75b3","webpack://chat-web/./src/LoginRegister.vue","webpack://chat-web/./src/LoginRegister.vue?ab54","webpack://chat-web/./src/router.js","webpack://chat-web/./src/main.js","webpack://chat-web/webpack/bootstrap","webpack://chat-web/webpack/runtime/chunk loaded","webpack://chat-web/webpack/runtime/compat get default export","webpack://chat-web/webpack/runtime/define property getters","webpack://chat-web/webpack/runtime/global","webpack://chat-web/webpack/runtime/hasOwnProperty shorthand","webpack://chat-web/webpack/runtime/jsonp chunk loading","webpack://chat-web/webpack/startup"],"sourcesContent":["<template>\r\n  <!-- <Chat /> -->\r\n  <router-view />\r\n</template>\r\n\r\n<script setup>\r\n// import Chat from './Chat.vue'\r\n</script> \r\n\r\n<style>\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n#app {\r\n  height: 100%;\r\n}\r\n</style>","import script from \"./App.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=57df1b6e&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { ref } from 'vue'\r\n\r\nexport const toUuid = ref('')\r\n// 好友列表，头像类型随机\r\nexport const friends = ref([])\r\n// 群聊列表，头像类型随机\r\nexport const groups = ref([])\r\n// 选择当前的聊天对象的昵称\r\nexport const currentChatTargetName = ref('')\r\n// 当前聊天对象的ID，这里使用uuid\r\nexport const currentChatID = ref('')\r\n// 聊天消息数据，可被其他脚本访问\r\nexport const chatMessages = ref({}) // { [uuid]: [msg, ...] }\r\n// 新时刻动态未读状态\r\nexport const hasUnreadMoments = ref(false)\r\n\r\n// 加好友请求消息框\r\nexport const showFriendRequest = ref(false)\r\nexport const friendRequestInfo = ref({\r\n    fromUsername: '',\r\n    content: '',\r\n    from: ''\r\n})\r\n// 加好友请求回复消息框\r\nexport const showFriendReplyRequest = ref(false)\r\nexport const friendResponseInfo = ref({\r\n    fromUsername: '',\r\n    content: '',\r\n    from: ''\r\n})\r\n// 1 好友 2 群组\r\nexport const currentChatType = ref(1)\r\n","<template>\n  <div v-if=\"visible\" class=\"toast\" :class=\"type\">\n    <div class=\"toast-content\">\n      <span class=\"toast-icon\">{{ getIcon() }}</span>\n      <span class=\"toast-message\">{{ message }}</span>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\n\nconst props = defineProps({\n  message: {\n    type: String,\n    required: true\n  },\n  type: {\n    type: String,\n    default: 'info', // info, success, warning, error\n    validator: (value) => ['info', 'success', 'warning', 'error'].includes(value)\n  },\n  duration: {\n    type: Number,\n    default: 3000\n  },\n  show: {\n    type: Boolean,\n    default: false\n  }\n})\n\nconst emit = defineEmits(['close'])\n\nconst visible = ref(false)\nlet timer = null\n\nwatch(() => props.show, (newVal) => {\n  if (newVal) {\n    showToast()\n  } else {\n    hideToast()\n  }\n})\n\nfunction showToast() {\n  visible.value = true\n  if (timer) {\n    clearTimeout(timer)\n  }\n  timer = setTimeout(() => {\n    hideToast()\n  }, props.duration)\n}\n\nfunction hideToast() {\n  visible.value = false\n  emit('close')\n}\n\nfunction getIcon() {\n  const icons = {\n    info: 'ℹ️',\n    success: '✅',\n    warning: '⚠️',\n    error: '❌'\n  }\n  return icons[props.type] || icons.info\n}\n</script>\n\n<style scoped>\n.toast {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  min-width: 300px;\n  max-width: 500px;\n  padding: 16px;\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  z-index: 9999;\n  animation: slideIn 0.3s ease-out;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n}\n\n.toast-content {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.toast-icon {\n  font-size: 18px;\n  flex-shrink: 0;\n}\n\n.toast-message {\n  font-size: 14px;\n  line-height: 1.4;\n  word-break: break-word;\n}\n\n/* 不同类型的样式 */\n.toast.info {\n  background-color: #e3f2fd;\n  border-left: 4px solid #2196f3;\n  color: #1565c0;\n}\n\n.toast.success {\n  background-color: #e8f5e8;\n  border-left: 4px solid #4caf50;\n  color: #2e7d32;\n}\n\n.toast.warning {\n  background-color: #fff3e0;\n  border-left: 4px solid #ff9800;\n  color: #ef6c00;\n}\n\n.toast.error {\n  background-color: #ffebee;\n  border-left: 4px solid #f44336;\n  color: #c62828;\n}\n\n@keyframes slideIn {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n/* 暗色主题支持 */\n@media (prefers-color-scheme: dark) {\n  .toast.info {\n    background-color: #1e3a8a;\n    color: #93c5fd;\n  }\n  \n  .toast.success {\n    background-color: #14532d;\n    color: #86efac;\n  }\n  \n  .toast.warning {\n    background-color: #92400e;\n    color: #fbbf24;\n  }\n  \n  .toast.error {\n    background-color: #7f1d1d;\n    color: #fca5a5;\n  }\n}\n</style>","import script from \"./Toast.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Toast.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Toast.vue?vue&type=style&index=0&id=61b92383&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-61b92383\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"left-list\">\r\n        <div class=\"my-info\">\r\n            <div class=\"my-avatar\">\r\n                <svg viewBox=\"0 0 36 36\" fill=\"none\" role=\"img\" xmlns=\"\" width=\"50\" height=\"50\">\r\n                    <mask id=\"«R47rrlb»\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width=\"36\" height=\"36\">\r\n                        <rect width=\"36\" height=\"36\" rx=\"72\" fill=\"#FFFFFF\"></rect>\r\n                    </mask>\r\n                    <g mask=\"url(#«R47rrlb»)\">\r\n                        <rect width=\"36\" height=\"36\" fill=\"#49007e\"></rect>\r\n                        <rect x=\"0\" y=\"0\" width=\"36\" height=\"36\" transform=\"translate(7 1) rotate(53 18 18) scale(1.2)\"\r\n                            fill=\"#ff7d10\" rx=\"6\"></rect>\r\n                        <g transform=\"translate(3.5 -4) rotate(3 18 18)\">\r\n                            <path d=\"M15 21c2 1 4 1 6 0\" stroke=\"#000000\" fill=\"none\" stroke-linecap=\"round\"></path>\r\n                            <rect x=\"11\" y=\"14\" width=\"1.5\" height=\"2\" rx=\"1\" stroke=\"none\" fill=\"#000000\"></rect>\r\n                            <rect x=\"23\" y=\"14\" width=\"1.5\" height=\"2\" rx=\"1\" stroke=\"none\" fill=\"#000000\"></rect>\r\n                        </g>\r\n                    </g>\r\n                </svg>\r\n            </div>\r\n            <div class=\"my-name\">{{ myName }}</div>\r\n            <div class=\"my-uuid\">{{ myUuid }}</div>\r\n        </div>\r\n        <div class=\"nav-list\">\r\n            <div class=\"nav-item\" :class=\"{ active: navTab === 'friend' }\" @click=\"handleNavClick('friend')\">\r\n                <span class=\"nav-icon\"></span> 好友\r\n            </div>\r\n            <div class=\"nav-item\" :class=\"{ active: navTab === 'group' }\" @click=\"handleNavClick('group')\">\r\n                <span class=\"nav-icon\"></span> 群组\r\n            </div>\r\n            <div class=\"nav-item\" :class=\"{ active: navTab === 'moment' }\" @click=\"handleNavClick('moment')\">\r\n                <span class=\"nav-icon\"></span>此刻\r\n                <div v-if=\"hasUnreadMoments\" class=\"moment-notification-dot\"></div>\r\n            </div>\r\n            <div class=\"nav-item\" @click=\"showSettings = true\"><span class=\"nav-icon\"></span>设置</div>\r\n        </div>\r\n    </div>\r\n    <div class=\"activated-list\">\r\n        <div v-if=\"navTab === 'friend'\">\r\n            <div class=\"friend-list-title-row\">\r\n                <div class=\"friend-list-title\">好友</div>\r\n                <button class=\"add-friend-btn\" @click=\"showAddFriend = true\">添加好友</button>\r\n            </div>\r\n            <div v-if=\"showAddFriend\" class=\"add-friend-dialog\">\r\n                <input v-model=\"newFriendName\" placeholder=\"Username\" class=\"add-friend-input\"\r\n                    @keyup.enter=\"searchFriend\" />\r\n                <button class=\"add-friend-confirm\" @click=\"searchFriend\" :disabled=\"searching\">Search</button>\r\n                <button class=\"add-friend-cancel\" @click=\"cancelAddFriend\">Cancel</button>\r\n            </div>\r\n            <div v-if=\"showAddFriend && (searchResults.length > 0 || searchError)\" class=\"search-result-list\">\r\n                <div v-if=\"searchError\" class=\"search-error\">{{ searchError }}</div>\r\n                <div v-for=\"f in searchResults\" :key=\"f.uuid\" class=\"search-result-item\" @click=\"addSearchedFriend(f)\">\r\n                    <span class=\"search-avatar\"\r\n                        v-if=\"f.avatar && (f.avatar.endsWith('.png') || f.avatar.endsWith('.jpg') || f.avatar.endsWith('.jpeg') || f.avatar.endsWith('.gif'))\">\r\n                        <img :src=\"'/avatars/' + f.avatar\" alt=\"avatar\"\r\n                            style=\"width:32px;height:32px;border-radius:50%;object-fit:cover;\" />\r\n                    </span>\r\n                    <span class=\"search-avatar\" v-else-if=\"f.avatar && f.avatar.startsWith('<svg')\"\r\n                        v-html=\"f.avatar\"></span>\r\n                    <span class=\"search-avatar\" v-else>{{ f.avatar || '😀' }}</span>\r\n                    <span class=\"search-nickname\">{{ f.nickname || f.username }}</span>\r\n                    <span class=\"search-uuid\">({{ f.uuid }})</span>\r\n                    <span class=\"search-add\">点击添加</span>\r\n                </div>\r\n            </div>\r\n\r\n            <div v-for=\"friend in friends\" :key=\"friend.uuid\" class=\"friend-item\"\r\n                :class=\"{ active: friend.uuid === toUuid }\" @click=\"selectFriend(friend)\">\r\n                <div class=\"friend-avatar\">\r\n                    <span v-if=\"friend.avatarType === 'emoji'\" class=\"avatar-emoji\">{{ friend.avatar }}</span>\r\n                    <span v-else-if=\"friend.avatarType === 'svg'\" v-html=\"friend.avatar\"></span>\r\n                </div>\r\n                <div class=\"friend-info\">\r\n                    <div class=\"friend-name\">{{ friend.name }}</div>\r\n                    <div class=\"friend-uuid\">{{ friend.uuid }}</div>\r\n                </div>\r\n                <div v-if=\"friend.unread > 0\" class=\"unread-bubble\">{{ friend.unread }}</div>\r\n            </div>\r\n        </div>\r\n        <div v-else-if=\"navTab === 'group'\">\r\n            <div class=\"group-list-title-row\">\r\n                <div class=\"group-list-title\">群聊</div>\r\n                <div class=\"group-actions\">\r\n                    <button class=\"create-group-btn\" @click=\"showCreateGroup = true\">＋创建群组</button>\r\n                    <button class=\"add-group-btn\" @click=\"showAddGroup = true\">＋加入群聊</button>\r\n                </div>\r\n            </div>\r\n            <div v-if=\"showCreateGroup\" class=\"create-group-dialog\">\r\n                <div class=\"create-group-form\">\r\n                    <div class=\"form-group\">\r\n                        <label>群组名称：</label>\r\n                        <input v-model=\"createGroupName\" placeholder=\"输入新群组名称\" class=\"create-group-input\" />\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label>群组类型：</label>\r\n                        <select v-model=\"createGroupType\" class=\"create-group-select\">\r\n                            <option value=\"\">请选择群组类型</option>\r\n                            <option value=\"游戏\">游戏</option>\r\n                            <option value=\"体育\">体育</option>\r\n                            <option value=\"新闻\">新闻</option>\r\n                            <option value=\"学习\">学习</option>\r\n                            <option value=\"工作\">工作</option>\r\n                            <option value=\"娱乐\">娱乐</option>\r\n                            <option value=\"生活\">生活</option>\r\n                            <option value=\"技术\">技术</option>\r\n                            <option value=\"其他\">其他</option>\r\n                        </select>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label>群组描述：</label>\r\n                        <textarea \r\n                            v-model=\"createGroupDescription\" \r\n                            placeholder=\"请输入群组描述（最多200字）\" \r\n                            class=\"create-group-textarea\"\r\n                            maxlength=\"200\"\r\n                        ></textarea>\r\n                        <div class=\"char-count\">{{ createGroupDescription.length }}/200</div>\r\n                    </div>\r\n                    <div class=\"form-actions\">\r\n                        <button class=\"create-group-confirm\" @click=\"createGroup\" :disabled=\"creatingGroup || !createGroupName.trim() || !createGroupType\">创建</button>\r\n                        <button class=\"create-group-cancel\" @click=\"cancelCreateGroup\">取消</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div v-if=\"showAddGroup\" class=\"add-group-dialog\">\r\n                <input v-model=\"newGroupName\" placeholder=\"输入要加入的群聊名称\" class=\"add-group-input\"\r\n                    @keyup.enter=\"joinGroup\" />\r\n                <button class=\"add-group-confirm\" @click=\"joinGroup\" :disabled=\"joiningGroup\">加入</button>\r\n                <button class=\"add-group-cancel\" @click=\"cancelAddGroup\">取消</button>\r\n            </div>\r\n            <div v-for=\"group in groups\" :key=\"group.uuid\" class=\"group-item\" :class=\"{ active: group.uuid === toUuid }\"\r\n                @click=\"selectGroup(group)\">\r\n                <div class=\"group-avatar\">\r\n                    <span v-if=\"group.avatarType === 'emoji'\" class=\"avatar-emoji\">{{ group.avatar }}</span>\r\n                    <span v-else-if=\"group.avatarType === 'svg'\" v-html=\"group.avatar\"></span>\r\n                </div>\r\n                <div class=\"group-info\">\r\n                    <div class=\"group-name\">{{ group.name }}</div>\r\n                    <div class=\"group-uuid\">{{ group.uuid }}</div>\r\n                </div>\r\n                <div v-if=\"group.unread > 0\" class=\"group_unread-bubble\">{{ group.unread }}</div>\r\n            </div>\r\n        </div>\r\n        <div v-else-if=\"navTab === 'moment'\">\r\n            <div class=\"moment-list-title-row\">\r\n                <div class=\"moment-list-title\">此刻</div>\r\n                <button class=\"add-moment-btn\" @click=\"showAddMoment = true\">发布动态</button>\r\n            </div>\r\n            <div v-if=\"showAddMoment\" class=\"add-moment-dialog\">\r\n                <textarea v-model=\"newMomentContent\" placeholder=\"分享你此刻在做什么...\" class=\"add-moment-textarea\"\r\n                    @keyup.ctrl.enter=\"publishMoment\" maxlength=\"200\"></textarea>\r\n                <div class=\"moment-actions\">\r\n                    <span class=\"char-count\">{{ newMomentContent.length }}/200</span>\r\n                    <button class=\"publish-moment-btn\" @click=\"publishMoment\" :disabled=\"!newMomentContent.trim() || publishingMoment\">发布</button>\r\n                    <button class=\"cancel-moment-btn\" @click=\"cancelAddMoment\">取消</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"moment-list\">\r\n                <div v-for=\"moment in moments\" :key=\"moment.id\" class=\"moment-item\">\r\n                    <div class=\"moment-header\">\r\n                        <div class=\"moment-avatar\">\r\n                            <svg viewBox=\"0 0 36 36\" fill=\"none\" role=\"img\" xmlns=\"\" width=\"32\" height=\"32\">\r\n                                <mask id=\"moment-avatar\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width=\"36\" height=\"36\">\r\n                                    <rect width=\"36\" height=\"36\" rx=\"72\" fill=\"#FFFFFF\"></rect>\r\n                                </mask>\r\n                                <g mask=\"url(#moment-avatar)\">\r\n                                    <rect width=\"36\" height=\"36\" fill=\"#49007e\"></rect>\r\n                                    <rect x=\"0\" y=\"0\" width=\"36\" height=\"36\" transform=\"translate(7 1) rotate(53 18 18) scale(1.2)\"\r\n                                        fill=\"#ff7d10\" rx=\"6\"></rect>\r\n                                </g>\r\n                            </svg>\r\n                        </div>\r\n                        <div class=\"moment-info\">\r\n                            <div class=\"moment-author\">{{ moment.author }}</div>\r\n                            <div class=\"moment-time\">{{ formatTime(moment.timestamp) }}</div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"moment-content\">{{ moment.content }}</div>\r\n                    <div class=\"moment-actions\">\r\n                        <button class=\"moment-action-btn\" @click=\"likeMoment(moment)\">\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                                <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\r\n                            </svg>\r\n                            <span>{{ moment.likes || 0 }}</span>\r\n                        </button>\r\n                        <button class=\"moment-action-btn\" @click=\"toggleComments(moment)\">\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                                <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\r\n                            </svg>\r\n                            <span>{{ moment.comments?.length || 0 }}</span>\r\n                        </button>\r\n                    </div>\r\n                    <!-- 评论区域 -->\r\n                    <div v-if=\"moment.showComments\" class=\"moment-comments\">\r\n                        <div class=\"comment-input-area\">\r\n                            <textarea \r\n                                v-model=\"moment.newComment\" \r\n                                placeholder=\"写下你的评论...\" \r\n                                class=\"comment-input\"\r\n                                @keyup.ctrl.enter=\"submitComment(moment)\"\r\n                                maxlength=\"500\"\r\n                            ></textarea>\r\n                            <div class=\"comment-actions\">\r\n                                <span class=\"comment-char-count\">{{ (moment.newComment || '').length }}/500</span>\r\n                                <button \r\n                                    class=\"submit-comment-btn\" \r\n                                    @click=\"submitComment(moment)\" \r\n                                    :disabled=\"!moment.newComment?.trim() || submittingComment\"\r\n                                >\r\n                                    发布评论\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"comments-list\">\r\n                            <div v-for=\"comment in moment.comments\" :key=\"comment.id\" class=\"comment-item\">\r\n                                <div class=\"comment-header\">\r\n                                    <div class=\"comment-avatar\">\r\n                                        <svg viewBox=\"0 0 36 36\" fill=\"none\" role=\"img\" xmlns=\"\" width=\"24\" height=\"24\">\r\n                                            <mask id=\"comment-avatar\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width=\"36\" height=\"36\">\r\n                                                <rect width=\"36\" height=\"36\" rx=\"72\" fill=\"#FFFFFF\"></rect>\r\n                                            </mask>\r\n                                            <g mask=\"url(#comment-avatar)\">\r\n                                                <rect width=\"36\" height=\"36\" fill=\"#49007e\"></rect>\r\n                                                <rect x=\"0\" y=\"0\" width=\"36\" height=\"36\" transform=\"translate(7 1) rotate(53 18 18) scale(1.2)\"\r\n                                                    fill=\"#ff7d10\" rx=\"6\"></rect>\r\n                                            </g>\r\n                                        </svg>\r\n                                    </div>\r\n                                    <div class=\"comment-info\">\r\n                                        <div class=\"comment-author\">{{ comment.author }}</div>\r\n                                        <div class=\"comment-time\">{{ formatTime(comment.timestamp) }}</div>\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"comment-content\">{{ comment.content }}</div>\r\n                            </div>\r\n                            <div v-if=\"!moment.comments || moment.comments.length === 0\" class=\"empty-comments\">\r\n                                <div class=\"empty-comment-text\">还没有评论，快来抢沙发吧！</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div v-if=\"moments.length === 0\" class=\"empty-moments\">\r\n                    <div class=\"empty-icon\">📝</div>\r\n                    <div class=\"empty-text\">还没有动态，快来发布第一条吧！</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"showFriendRequest\" class=\"friend-request-overlay\">\r\n            <div class=\"friend-request-dialog\">\r\n                <h3>好友请求</h3>\r\n                <p>来自：{{ friendRequestInfo.fromUsername }}</p>\r\n                <p>留言：{{ friendRequestInfo.content }}</p>\r\n                <div class=\"request-buttons\">\r\n                    <button @click=\"handleFriendRequest(true)\" class=\"accept-btn\">接受</button>\r\n                    <button @click=\"handleFriendRequest(false)\" class=\"reject-btn\">拒绝</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"showFriendReplyRequest\" class=\"friend-response-overlay\">\r\n            <div class=\"friend-response-dialog\">\r\n                <h3>好友请求回复</h3>\r\n                <p>来自：{{ friendResponseInfo.fromUsername }}</p>\r\n                <p>留言：{{ friendResponseInfo.content }}</p>\r\n                <div class=\"response-buttons\">\r\n                    <button @click=\"handleFriendResponse()\" class=\"ok-btn\">知道了</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"showSettings\" class=\"settings-overlay\">\r\n            <div class=\"settings-dialog\">\r\n                <div class=\"settings-header\">\r\n                    <h3>设置</h3>\r\n                    <button class=\"close-btn\" @click=\"showSettings = false\">×</button>\r\n                </div>\r\n                <div class=\"settings-content\">\r\n                    <div class=\"settings-tabs\">\r\n                        <button class=\"tab-btn\" :class=\"{ active: settingsTab === 'profile' }\"\r\n                            @click=\"settingsTab = 'profile'\">\r\n                            个人信息\r\n                        </button>\r\n                        <button class=\"tab-btn\" :class=\"{ active: settingsTab === 'password' }\"\r\n                            @click=\"settingsTab = 'password'\">\r\n                            修改密码\r\n                        </button>\r\n                        <button class=\"tab-btn\" :class=\"{ active: settingsTab === 'theme' }\"\r\n                            @click=\"settingsTab = 'theme'\">\r\n                            主题设置\r\n                        </button>\r\n                    </div>\r\n\r\n                    <!-- 个人信息设置 -->\r\n                    <div v-if=\"settingsTab === 'profile'\" class=\"settings-panel\">\r\n                        <div class=\"form-group\">\r\n                            <label>昵称：</label>\r\n                            <input v-model=\"profileForm.nickname\" type=\"text\" class=\"form-input\" placeholder=\"请输入昵称\" />\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label>用户名：</label>\r\n                            <input v-model=\"profileForm.username\" type=\"text\" class=\"form-input\" placeholder=\"请输入用户名\" />\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label>邮箱：</label>\r\n                            <input v-model=\"profileForm.email\" type=\"email\" class=\"form-input\" placeholder=\"请输入邮箱\" />\r\n                        </div>\r\n                        <div class=\"form-actions\">\r\n                            <button @click=\"updateProfile\" class=\"save-btn\" :disabled=\"updatingProfile\">保存</button>\r\n                            <button @click=\"resetProfileForm\" class=\"cancel-btn\">重置</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- 修改密码 -->\r\n                    <div v-if=\"settingsTab === 'password'\" class=\"settings-panel\">\r\n                        <div class=\"form-group\">\r\n                            <label>当前密码：</label>\r\n                            <input v-model=\"passwordForm.currentPassword\" type=\"password\" class=\"form-input\"\r\n                                placeholder=\"请输入当前密码\" />\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label>新密码：</label>\r\n                            <input v-model=\"passwordForm.newPassword\" type=\"password\" class=\"form-input\"\r\n                                placeholder=\"请输入新密码\" />\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label>确认新密码：</label>\r\n                            <input v-model=\"passwordForm.confirmPassword\" type=\"password\" class=\"form-input\"\r\n                                placeholder=\"请再次输入新密码\" />\r\n                        </div>\r\n                        <div class=\"form-actions\">\r\n                            <button @click=\"updatePassword\" class=\"save-btn\" :disabled=\"updatingPassword\">修改密码</button>\r\n                            <button @click=\"resetPasswordForm\" class=\"cancel-btn\">重置</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- 主题设置 -->\r\n                    <div v-if=\"settingsTab === 'theme'\" class=\"settings-panel\">\r\n                        <div class=\"theme-section\">\r\n                            <h4>外观模式</h4>\r\n                            <div class=\"theme-options\">\r\n                                <div class=\"theme-option\" :class=\"{ active: currentTheme === 'light' }\" @click=\"setTheme('light')\">\r\n                                    <div class=\"theme-preview light-preview\">\r\n                                        <div class=\"preview-header\"></div>\r\n                                        <div class=\"preview-content\"></div>\r\n                                    </div>\r\n                                    <span>浅色模式</span>\r\n                                </div>\r\n                                <div class=\"theme-option\" :class=\"{ active: currentTheme === 'dark' }\" @click=\"setTheme('dark')\">\r\n                                    <div class=\"theme-preview dark-preview\">\r\n                                        <div class=\"preview-header\"></div>\r\n                                        <div class=\"preview-content\"></div>\r\n                                    </div>\r\n                                    <span>深色模式</span>\r\n                                </div>\r\n                                <div class=\"theme-option\" :class=\"{ active: currentTheme === 'eye-care' }\" @click=\"setTheme('eye-care')\">\r\n                                    <div class=\"theme-preview eye-care-preview\">\r\n                                        <div class=\"preview-header\"></div>\r\n                                        <div class=\"preview-content\"></div>\r\n                                    </div>\r\n                                    <span>护眼模式</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        \r\n                        <div class=\"theme-section\">\r\n                            <h4>个性化设置</h4>\r\n                            <div class=\"form-group\">\r\n                                <label>\r\n                                    <input type=\"checkbox\" v-model=\"autoTheme\" @change=\"toggleAutoTheme\">\r\n                                    跟随系统主题\r\n                                </label>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <label>\r\n                                    <input type=\"checkbox\" v-model=\"eyeCareMode\" @change=\"toggleEyeCareMode\">\r\n                                    护眼模式增强\r\n                                </label>\r\n                                <small>降低蓝光，减少眼部疲劳</small>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n    <!-- Toast 提示框 -->\r\n    <Toast \r\n        :message=\"toastMessage\" \r\n        :type=\"toastType\" \r\n        :show=\"showToast\" \r\n        @close=\"showToast = false\" \r\n    />\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted} from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { toUuid, currentChatTargetName, currentChatID, showFriendRequest, friendRequestInfo, showFriendReplyRequest, friendResponseInfo, friends, groups, hasUnreadMoments, currentChatType } from './state.js'\r\nimport Toast from '../Toast.vue'\r\n\r\n\r\nconst route = useRoute()\r\nconst sessionKey = route.query.session || 'default'\r\nconst userinfo = JSON.parse(localStorage.getItem(`userinfo_${sessionKey}`) || '{}')\r\nconst myName = userinfo.nickname || '我'\r\nconst myUuid = userinfo.uuid\r\nconst token = localStorage.getItem(`token_${sessionKey}`)\r\nconst navTab = ref('friend') // 当前左侧tab，默认展示好友\r\nconst showAddFriend = ref(false)\r\nconst newFriendName = ref('')\r\nconst searchResults = ref([])\r\nconst searching = ref(false)\r\nconst searchError = ref('')\r\nconst showAddGroup = ref(false)\r\nconst newGroupName = ref('')\r\nconst showCreateGroup = ref(false)\r\nconst createGroupName = ref('')\r\nconst createGroupType = ref('')\r\nconst createGroupDescription = ref('')\r\nconst creatingGroup = ref(false)\r\nconst joiningGroup = ref(false)\r\n\r\n// Toast 相关变量\r\nconst showToast = ref(false)\r\nconst toastMessage = ref('')\r\nconst toastType = ref('info')\r\n// 好友列表和群聊列表现在从 state.js 导入\r\n// 当前消息类型，1=单聊，2=群聊\r\nconst messageType = ref(1)\r\n// 好友请求相关变量已移动到 state.js 中\r\n// 设置相关\r\nconst showSettings = ref(false)\r\nconst settingsTab = ref('profile') // 'profile'、'password' 或 'theme'\r\n\r\n// 主题相关\r\nconst currentTheme = ref(localStorage.getItem('chat-theme') || 'light')\r\nconst autoTheme = ref(localStorage.getItem('chat-auto-theme') === 'true')\r\nconst eyeCareMode = ref(localStorage.getItem('chat-eye-care') === 'true')\r\nconst updatingProfile = ref(false)\r\nconst updatingPassword = ref(false)\r\n// 个人信息表单\r\nconst profileForm = ref({\r\n    nickname: userinfo.nickname || '',\r\n    username: userinfo.username || '',\r\n    email: userinfo.email || ''\r\n})\r\n// 密码修改表单\r\nconst passwordForm = ref({\r\n    currentPassword: '',\r\n    newPassword: '',\r\n    confirmPassword: ''\r\n})\r\n// 此刻功能相关\r\nconst showAddMoment = ref(false)\r\nconst newMomentContent = ref('')\r\nconst publishingMoment = ref(false)\r\nconst moments = ref([])\r\nconst submittingComment = ref(false)\r\n// const currentChatID = ref(0)\r\nonMounted(async () => {\r\n    getFriendList()\r\n    getGroupList()\r\n    \r\n    // 初始化主题设置\r\n    applyTheme(currentTheme.value)\r\n    applyEyeCareMode()\r\n    setupThemeListener()\r\n})\r\n\r\n// 显示 Toast 提示\r\nfunction showToastMessage(message, type = 'info', duration = 3000) {\r\n    toastMessage.value = message\r\n    toastType.value = type\r\n    showToast.value = true\r\n    \r\n    // 自动隐藏\r\n    setTimeout(() => {\r\n        showToast.value = false\r\n    }, duration)\r\n}\r\n\r\nfunction handleNavClick(tab) {\r\n    navTab.value = tab\r\n    if (tab === 'friend') {\r\n        getFriendList()\r\n    } else if (tab === 'group') {\r\n        getGroupList()\r\n    } else if (tab === 'moment') {\r\n        getMomentList()\r\n        // 清除未读时刻状态\r\n        hasUnreadMoments.value = false\r\n    }\r\n}\r\nasync function searchFriend() {\r\n    const name = newFriendName.value.trim()\r\n    if (!name) return\r\n    searching.value = true\r\n    searchError.value = ''\r\n    searchResults.value = []\r\n    try {\r\n        const resp = await fetch(`http://62.234.192.227/v1/api/friend/search?username=${encodeURIComponent(name)}`, {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        })\r\n        if (!resp.ok) throw new Error('网络错误')\r\n        const data = await resp.json()\r\n        if (data && data.data && data.data.uuid) {\r\n            searchResults.value = [data.data]\r\n        } else {\r\n            searchError.value = '未找到相关用户'\r\n        }\r\n    } catch (e) {\r\n        searchError.value = '搜索失败：' + e.message\r\n    } finally {\r\n        searching.value = false\r\n    }\r\n}\r\n// 添加发送好友请求的逻辑\r\nfunction addSearchedFriend(f) {\r\n    const sendAddRequest = async () => {\r\n        try {\r\n            const resp = await fetch('http://62.234.192.227/v1/api/friend/addFriend', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    target_user_name: f.username,  // 目标用户名\r\n                    content: '你好，我是',\r\n                })\r\n            });\r\n            const data = await resp.json();\r\n            if (data.code !== 200) {\r\n                throw new Error(data.msg || '添加好友失败');\r\n            } else if (data.code === 201) {\r\n                throw new Error(data.msg || '好友已存在');\r\n            }\r\n            showToastMessage('好友请求已发送', 'success');\r\n        } catch (e) {\r\n            searchError.value = '添加失败: ' + e.message;\r\n        }\r\n    };\r\n    // 先发送好友请求，再添加本地列表\r\n    sendAddRequest().then(() => {\r\n        friends.value.push({\r\n            uuid: f.uuid,\r\n            name: f.nickname || f.username,\r\n        });\r\n        showAddFriend.value = false;\r\n        newFriendName.value = '';\r\n        searchResults.value = [];\r\n        searchError.value = '';\r\n    });\r\n}\r\nfunction cancelAddFriend() {\r\n    showAddFriend.value = false\r\n    newFriendName.value = ''\r\n    searchResults.value = []\r\n    searchError.value = ''\r\n}\r\n// 创建群组\r\nasync function createGroup() {\r\n    const name = createGroupName.value.trim()\r\n    const type = createGroupType.value.trim()\r\n    const description = createGroupDescription.value.trim()\r\n    \r\n    if (!name) {\r\n        showToastMessage('请输入群组名称', 'warning')\r\n        return\r\n    }\r\n    \r\n    if (!type) {\r\n        showToastMessage('请选择群组类型', 'warning')\r\n        return\r\n    }\r\n\r\n    creatingGroup.value = true\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/group/createGroup', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                group_name: name,\r\n                group_type: type,\r\n                description: description\r\n            })\r\n        })\r\n\r\n        if (!resp.ok) throw new Error('网络错误')\r\n        const data = await resp.json()\r\n        if (data.code !== 0) throw new Error(data.msg || '创建失败')\r\n        console.log(data)\r\n\r\n        //uuid: item.group_uuid,\r\n        //name: item.group_name,\r\n        groups.value.push({\r\n            uuid: data.data.group_id,\r\n            name: data.data.group_name,\r\n            type: type,\r\n            description: description,\r\n            unread: 0\r\n        })\r\n\r\n        showToastMessage('群组创建成功', 'success')\r\n        cancelCreateGroup()\r\n    } catch (e) {\r\n        showToastMessage('创建群组失败: ' + e.message, 'error')\r\n    } finally {\r\n        creatingGroup.value = false\r\n    }\r\n}\r\n// 加入群组\r\nasync function joinGroup() {\r\n    const name = newGroupName.value.trim()\r\n    if (!name) {\r\n        showToastMessage('请输入群聊名称', 'warning')\r\n        return\r\n    }\r\n\r\n    joiningGroup.value = true\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/group/joinGroup', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                group_name: name,\r\n            })\r\n        })\r\n\r\n        if (!resp.ok) throw new Error('网络错误')\r\n        const data = await resp.json()\r\n        if (data.code !== 0) throw new Error(data.msg || '加入失败')\r\n        console.log(data)\r\n        groups.value.push({\r\n            uuid: data.data.group_uuid,\r\n            name: data.data.group_name,\r\n            unread: 0\r\n        })\r\n\r\n        showToastMessage('成功加入群聊', 'success')\r\n        cancelAddGroup()\r\n    } catch (e) {\r\n        showToastMessage('加入群聊失败: ' + e.message, 'error')\r\n    } finally {\r\n        joiningGroup.value = false\r\n    }\r\n}\r\n// 取消创建群组\r\nfunction cancelCreateGroup() {\r\n    showCreateGroup.value = false\r\n    createGroupName.value = ''\r\n    createGroupType.value = ''\r\n    createGroupDescription.value = ''\r\n}\r\n// 取消加入群组\r\nfunction cancelAddGroup() {\r\n    showAddGroup.value = false\r\n    newGroupName.value = ''\r\n}\r\n// 选择一个朋友\r\nfunction selectFriend(friend) {\r\n    toUuid.value = friend.uuid\r\n    currentChatType.value = 1\r\n    currentChatID.value = friend.uuid\r\n    friend.unread = 0\r\n    currentChatTargetName.value = friend.name\r\n    // 保存未读消息计数到localStorage\r\n    saveUnreadCounts()\r\n}\r\n// 选择一个群组\r\nfunction selectGroup(group) {\r\n    console.log(group)\r\n    toUuid.value = group.uuid\r\n    currentChatType.value = 2\r\n    currentChatID.value = group.uuid\r\n    group.unread = 0\r\n    currentChatTargetName.value = group.name\r\n    // 保存未读消息计数到localStorage\r\n    saveUnreadCounts()\r\n}\r\n// 保存未读消息计数到localStorage\r\nfunction saveUnreadCounts() {\r\n    const unreadCounts = {}\r\n    // 保存好友的未读消息计数\r\n    friends.value.forEach(friend => {\r\n        if (friend.unread > 0) {\r\n            unreadCounts[friend.uuid] = friend.unread\r\n        }\r\n    })\r\n    // 保存群组的未读消息计数\r\n    groups.value.forEach(group => {\r\n        if (group.unread > 0) {\r\n            unreadCounts[group.uuid] = group.unread\r\n        }\r\n    })\r\n    localStorage.setItem(`unreadCounts_${sessionKey}`, JSON.stringify(unreadCounts))\r\n}\r\n// 添加处理好友请求的方法\r\nasync function handleFriendRequest(isAccept) {\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/friend/handleRequest', {  // Changed endpoint\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                status: isAccept ? 1 : 0,\r\n                target_uuid: friendRequestInfo.value.from\r\n            })\r\n        });\r\n    } catch (e) {\r\n        showToastMessage('操作失败: ' + e.message, 'error');\r\n    } finally {\r\n        showFriendRequest.value = false;\r\n    }\r\n}\r\n// 添加处理好友回复请求的方法\r\nasync function handleFriendResponse() {\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/friend/handleResponse', {  // Changed endpoint\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                status: 1,\r\n                target_uuid: friendResponseInfo.value.from\r\n            })\r\n        });\r\n        // 刷新好友列表\r\n        getFriendList()\r\n    } catch (e) {\r\n        showToastMessage('操作失败: ' + e.message, 'error');\r\n    } finally {\r\n        showFriendReplyRequest.value = false;\r\n    }\r\n}\r\n// 获取好友列表\r\nasync function getFriendList() {\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/friend/getFriendList', {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        });\r\n\r\n        const data = await resp.json();\r\n        // 从localStorage获取未读消息计数\r\n        const savedUnreadCounts = JSON.parse(localStorage.getItem(`unreadCounts_${sessionKey}`) || '{}')\r\n        friends.value = data.data.map(item => ({\r\n            name: item.friend_nickname,\r\n            uuid: item.friend_uuid,\r\n            unread: savedUnreadCounts[item.friend_uuid] || 0\r\n        }))\r\n    } catch (e) {\r\n        // alert(e.message);\r\n    }\r\n}\r\n// 获取群组列表\r\nasync function getGroupList() {\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/group/getGroupList', {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        });\r\n\r\n        const data = await resp.json();\r\n        // 从localStorage获取未读消息计数\r\n        const savedUnreadCounts = JSON.parse(localStorage.getItem(`unreadCounts_${sessionKey}`) || '{}')\r\n        groups.value = data.data.map(item => ({\r\n            uuid: item.group_uuid,\r\n            name: item.group_name,\r\n            unread: savedUnreadCounts[item.group_uuid] || 0\r\n        }))\r\n    } catch (e) {\r\n        // alert(e.message);\r\n    }\r\n}\r\n// 设置相关方法\r\n// 更新个人信息\r\nasync function updateProfile() {\r\n    if (!profileForm.value.nickname.trim()) {\r\n        showToastMessage('昵称不能为空', 'warning')\r\n        return\r\n    }\r\n\r\n    updatingProfile.value = true\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/profile/updateProfile', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                username: profileForm.value.username,\r\n                nickname: profileForm.value.nickname,\r\n                email: profileForm.value.email,\r\n                avatar: profileForm.value.avatar || ''\r\n            })\r\n        })\r\n\r\n        const data = await resp.json()\r\n        if (data.code == 0) {\r\n            showToastMessage('更新成功', 'success')\r\n        }\r\n        else {\r\n            showToastMessage('更新失败', 'error')\r\n        }\r\n    } catch (e) {\r\n        showToastMessage('更新失败: ' + e.message, 'error')\r\n    } finally {\r\n        updatingProfile.value = false\r\n    }\r\n}\r\n// 修改密码\r\nasync function updatePassword() {\r\n    if (!passwordForm.value.currentPassword) {\r\n        showToastMessage('请输入当前密码', 'warning')\r\n        return\r\n    }\r\n\r\n    if (!passwordForm.value.newPassword) {\r\n        showToastMessage('请输入新密码', 'warning')\r\n        return\r\n    }\r\n\r\n    if (passwordForm.value.newPassword.length < 6) {\r\n        showToastMessage('新密码长度不能少于6位', 'warning')\r\n        return\r\n    }\r\n\r\n    if (passwordForm.value.newPassword !== passwordForm.value.confirmPassword) {\r\n        showToastMessage('两次输入的新密码不一致', 'warning')\r\n        return\r\n    }\r\n\r\n    updatingPassword.value = true\r\n    try {\r\n        const resp = await fetch('http://62.234.192.227/v1/api/user/updatePassword', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                currentPassword: passwordForm.value.currentPassword,\r\n                newPassword: passwordForm.value.newPassword\r\n            })\r\n        })\r\n\r\n        const data = await resp.json()\r\n        if (data.code === 200) {\r\n            showToastMessage('密码修改成功', 'success')\r\n            resetPasswordForm()\r\n        } else {\r\n            throw new Error(data.msg || '修改失败')\r\n        }\r\n    } catch (e) {\r\n        showToastMessage('修改失败: ' + e.message, 'error')\r\n    } finally {\r\n        updatingPassword.value = false\r\n    }\r\n}\r\n// 重置个人信息表单\r\nfunction resetProfileForm() {\r\n    profileForm.value = {\r\n        nickname: userinfo.nickname || '',\r\n        username: userinfo.username || '',\r\n        email: userinfo.email || ''\r\n    }\r\n}\r\n// 重置密码表单\r\nfunction resetPasswordForm() {\r\n    passwordForm.value = {\r\n        currentPassword: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n    }\r\n}\r\n\r\n// 主题相关方法\r\nfunction setTheme(theme) {\r\n    currentTheme.value = theme\r\n    localStorage.setItem('chat-theme', theme)\r\n    applyTheme(theme)\r\n}\r\n\r\nfunction toggleAutoTheme() {\r\n    localStorage.setItem('chat-auto-theme', autoTheme.value.toString())\r\n    if (autoTheme.value) {\r\n        // 检测系统主题\r\n        const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'\r\n        setTheme(systemTheme)\r\n    }\r\n}\r\n\r\nfunction toggleEyeCareMode() {\r\n    localStorage.setItem('chat-eye-care', eyeCareMode.value.toString())\r\n    applyEyeCareMode()\r\n}\r\n\r\nfunction applyTheme(theme) {\r\n    const root = document.documentElement\r\n    root.setAttribute('data-theme', theme)\r\n    // 移除之前的主题类\r\n    root.classList.remove('light-theme', 'dark-theme', 'eye-care-theme')\r\n    // 添加新的主题类\r\n    root.classList.add(`${theme}-theme`)\r\n}\r\n\r\nfunction applyEyeCareMode() {\r\n    const root = document.documentElement\r\n    if (eyeCareMode.value) {\r\n        root.classList.add('eye-care-enhanced')\r\n    } else {\r\n        root.classList.remove('eye-care-enhanced')\r\n    }\r\n}\r\n\r\n// 监听系统主题变化\r\nfunction setupThemeListener() {\r\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)')\r\n    mediaQuery.addEventListener('change', (e) => {\r\n        if (autoTheme.value) {\r\n            const systemTheme = e.matches ? 'dark' : 'light'\r\n            setTheme(systemTheme)\r\n        }\r\n    })\r\n}\r\n\r\n// 此刻功能相关方法\r\n// 发布动态\r\nasync function publishMoment() {\r\n    const content = newMomentContent.value.trim()\r\n    if (!content) {\r\n        showToastMessage('请输入动态内容', 'warning')\r\n        return\r\n    }\r\n    publishingMoment.value = true\r\n    try {\r\n        // 这里可以添加实际的API调用\r\n        const resp = await fetch('http://62.234.192.227/v1/api/moment/createMoment', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                content: content\r\n            })\r\n        })\r\n        //const data = await resp.json()\r\n        // if (data.code === 200) {\r\n        //     alert('动态发布成功')\r\n        // } else {\r\n        //     throw new Error(data.msg || '发布失败')\r\n        // }\r\n        // 暂时使用本地存储模拟\r\n        const newMoment = {\r\n            id: Date.now(),\r\n            author: myName,\r\n            content: content,\r\n            timestamp: new Date().toISOString()\r\n        }\r\n        moments.value.unshift(newMoment)\r\n        // 保存到localStorage\r\n        const savedMoments = JSON.parse(localStorage.getItem(`moments_${sessionKey}`) || '[]')\r\n        savedMoments.unshift(newMoment)\r\n        localStorage.setItem(`moments_${sessionKey}`, JSON.stringify(savedMoments))\r\n        cancelAddMoment()\r\n    } catch (e) {\r\n        showToastMessage('发布失败: ' + e.message, 'error')\r\n    } finally {\r\n        publishingMoment.value = false\r\n    }\r\n}\r\n\r\n// 取消发布动态\r\nfunction cancelAddMoment() {\r\n    showAddMoment.value = false\r\n    newMomentContent.value = ''\r\n}\r\n\r\n// 获取动态列表\r\nasync function getMomentList() {\r\n    try {\r\n        // 这里可以添加实际的API调用\r\n        const resp = await fetch('http://62.234.192.227/v1/api/moment/list', {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        })\r\n        const data = await resp.json()\r\n        if (data.code === 0) {\r\n            moments.value = data.data.map(item => ({\r\n                moment_id: item.moment_id,\r\n                user_id: item.user_id,\r\n                author: item.username,\r\n                content: item.content,\r\n                likes: item.like_count,\r\n                comments: item.comment_list,\r\n                timestamp: item.create_time,\r\n            }))\r\n        }\r\n    } catch (e) {\r\n        showToastMessage('获取动态列表失败: ' + e.message, 'error')\r\n    }\r\n}\r\n\r\n// 格式化时间\r\nfunction formatTime(timestamp) {\r\n    const date = new Date(timestamp)\r\n    const now = new Date()\r\n    const diff = now - date\r\n    if (diff < 60000) { // 1分钟内\r\n        return '刚刚'\r\n    } else if (diff < 3600000) { // 1小时内\r\n        return Math.floor(diff / 60000) + '分钟前'\r\n    } else if (diff < 86400000) { // 24小时内\r\n        return Math.floor(diff / 3600000) + '小时前'\r\n    } else if (diff < 604800000) { // 7天内\r\n        return Math.floor(diff / 86400000) + '天前'\r\n    } else {\r\n        return date.toLocaleDateString()\r\n    }\r\n}\r\n\r\n// todo 点赞动态\r\nasync function likeMoment(moment) {\r\n    console.log('点赞动态2:', moment['moment_id'])\r\n    console.log('moment_id类型:', typeof moment['moment_id'])\r\n    const momentId = parseInt(moment['moment_id'])\r\n    console.log('parseInt后的值:', momentId)\r\n    console.log('parseInt后的类型:', typeof momentId)\r\n    try {\r\n        // 这里可以添加实际的API调用\r\n        const requestBody = {\r\n            moment_id: momentId\r\n        }\r\n        const resp = await fetch('http://62.234.192.227/v1/api/comment/like', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify(requestBody)\r\n        })\r\n        const data = await resp.json()\r\n        if (data.code === 0) {\r\n            showToastMessage('点赞成功', 'success')\r\n             if (!moment.likes) {\r\n                moment.likes = 0\r\n            }\r\n            moment.likes++\r\n            console.log('点赞动态:', moment)\r\n        } else {\r\n            throw new Error(data.msg || '你已经点赞过了')\r\n        }\r\n    } catch (e) {\r\n        showToastMessage('点赞失败: ' + e.message, 'error')\r\n    }\r\n}\r\n\r\n// 切换评论显示状态\r\nfunction toggleComments(moment) {\r\n    moment.showComments = !moment.showComments\r\n    // 如果是第一次打开评论区，初始化评论数据\r\n    if (moment.showComments && !moment.comments) {\r\n        moment.comments = []\r\n        moment.newComment = ''\r\n        // 获取该动态的评论列表\r\n        getCommentList(moment)\r\n    }\r\n}\r\n\r\n// 提交评论\r\nasync function submitComment(moment) {\r\n    const content = moment.newComment?.trim()\r\n    if (!content) {\r\n        showToastMessage('请输入评论内容', 'warning')\r\n        return\r\n    }\r\n    submittingComment.value = true\r\n    try {\r\n        const momentId = parseInt(moment['moment_id'] || moment.id)\r\n        \r\n        // 调用后端API提交评论\r\n        const resp = await fetch('http://62.234.192.227/v1/api/comment/create', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                moment_id: momentId,\r\n                content: content\r\n            })\r\n        })\r\n        \r\n        const data = await resp.json()\r\n        if (data.code === 0) {\r\n            // 创建新评论对象\r\n            const newComment = {\r\n                id: Date.now(),\r\n                author: myName,\r\n                content: content,\r\n                timestamp: new Date().toISOString()\r\n            }\r\n            // 添加到评论列表\r\n            if (!moment.comments) {\r\n                moment.comments = []\r\n            }\r\n            moment.comments.unshift(newComment)\r\n            // 清空输入框\r\n            moment.newComment = ''\r\n        } else {\r\n            throw new Error(data.msg || '评论发布失败')\r\n        }\r\n    } catch (e) {\r\n        showToastMessage('评论发布失败: ' + e.message, 'error')\r\n    } finally {\r\n        submittingComment.value = false\r\n    }\r\n}\r\n\r\n// 获取评论列表\r\nasync function getCommentList(moment) {\r\n    try {\r\n        const momentId = parseInt(moment['moment_id'] || moment.id)\r\n        const resp = await fetch(`http://62.234.192.227/v1/api/comment/list?moment_id=${momentId}`, {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        })\r\n        const data = await resp.json()\r\n        if (data.code === 0) {\r\n            moment.comments = data.data.map(item => ({\r\n                id: item.comment_id,\r\n                author: item.username,\r\n                content: item.content,\r\n                timestamp: item.create_time\r\n            }))\r\n        }\r\n    } catch (e) {\r\n        showToastMessage('获取评论列表失败: ' + e.message, 'error')\r\n        // 如果获取失败，初始化为空数组\r\n        moment.comments = []\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.chat-layout {\r\n    display: flex;\r\n    height: 100vh;\r\n    background: #f5f5f5;\r\n    overflow: hidden;\r\n}\r\n\r\n.left-list {\r\n    width: 120px;\r\n    background: #fff;\r\n    border-right: 1px solid #eee;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    padding: 0 0 8px 0;\r\n}\r\n\r\n.my-info {\r\n    width: 100%;\r\n    padding: 16px 0 8px 0;\r\n    border-bottom: 1px solid #eee;\r\n    background: #f7f7f7;\r\n    margin-bottom: 8px;\r\n    text-align: center;\r\n}\r\n\r\n.my-avatar {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    margin-bottom: 8px;\r\n}\r\n\r\n.avatar-emoji {\r\n    font-size: 48px;\r\n    display: inline-block;\r\n}\r\n\r\n.my-name {\r\n    font-size: 15px;\r\n    font-weight: bold;\r\n    margin-bottom: 2px;\r\n}\r\n\r\n.my-uuid {\r\n    font-size: 12px;\r\n    color: #888;\r\n    word-break: break-all;\r\n}\r\n\r\n.nav-list {\r\n    width: 100%;\r\n    margin-top: 16px;\r\n}\r\n\r\n.nav-item {\r\n    display: flex;\r\n    align-items: center;\r\n    font-size: 16px;\r\n    padding: 12px 0 12px 0;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: background 0.2s;\r\n    border-radius: 6px;\r\n    margin: 0 8px 8px 8px;\r\n    position: relative;\r\n}\r\n\r\n.nav-item:hover {\r\n    background: #e6f7ff;\r\n}\r\n\r\n.nav-icon {\r\n    font-size: 20px;\r\n    margin-right: 6px;\r\n}\r\n\r\n.moment-notification-dot {\r\n    position: absolute;\r\n    top: 8px;\r\n    right: 20px;\r\n    width: 8px;\r\n    height: 8px;\r\n    background: #ff4444;\r\n    border-radius: 50%;\r\n    border: 2px solid #fff;\r\n}\r\n\r\n.activated-list {\r\n    width: 380px;\r\n    background: #fff;\r\n    border-right: 1px solid #eee;\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: 0 0 8px 0;\r\n}\r\n\r\n.friend-list-title {\r\n    font-weight: bold;\r\n    font-size: 16px;\r\n    padding: 16px 0 8px 16px;\r\n    /* border-bottom: 1px solid #eee; */\r\n    margin-bottom: 8px;\r\n}\r\n\r\n.friend-list-title-row {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: 0 8px 0 0;\r\n}\r\n\r\n.group-list-title {\r\n    font-weight: bold;\r\n    font-size: 16px;\r\n    padding: 16px 0 8px 16px;\r\n    /* border-bottom: 1px solid #eee; */\r\n    margin-bottom: 8px;\r\n}\r\n\r\n.group-list-title-row {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: 0 8px 0 0;\r\n}\r\n\r\n.group-actions {\r\n    display: flex;\r\n    gap: 8px;\r\n}\r\n\r\n.create-group-btn {\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 8px;\r\n    font-size: 12px;\r\n    cursor: pointer;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.create-group-btn:hover {\r\n    background: #369870;\r\n}\r\n\r\n.add-friend-btn {\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 12px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    margin-left: 8px;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.add-friend-btn:hover {\r\n    background: #369870;\r\n}\r\n\r\n.add-group-btn {\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 8px;\r\n    font-size: 12px;\r\n    cursor: pointer;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.add-group-btn:hover {\r\n    background: #369870;\r\n}\r\n\r\n.add-friend-dialog {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 8px 8px 8px 16px;\r\n    background: #f7f7f7;\r\n    border-radius: 6px;\r\n    margin: 8px 8px 0 8px;\r\n}\r\n\r\n.add-friend-input {\r\n    flex: 1;\r\n    padding: 6px 8px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n    font-size: 14px;\r\n    margin-right: 8px;\r\n}\r\n\r\n.add-friend-confirm {\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 10px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    margin-right: 4px;\r\n}\r\n\r\n.add-friend-confirm:disabled {\r\n    background: #ccc;\r\n    cursor: not-allowed;\r\n}\r\n\r\n.add-friend-cancel {\r\n    background: #eee;\r\n    color: #333;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 10px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n}\r\n\r\n.create-group-dialog {\r\n    background: #f7f7f7;\r\n    border-radius: 8px;\r\n    margin: 8px;\r\n    padding: 20px;\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    max-height: 400px;\r\n    overflow-y: auto;\r\n}\r\n\r\n.create-group-form {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 15px;\r\n}\r\n\r\n.create-group-form .form-group {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 5px;\r\n}\r\n\r\n.create-group-form .form-group label {\r\n    font-size: 13px;\r\n    font-weight: 500;\r\n    color: #333;\r\n}\r\n\r\n.create-group-input,\r\n.create-group-select {\r\n    width: 100%;\r\n    padding: 8px 12px;\r\n    border: 1px solid #ddd;\r\n    border-radius: 4px;\r\n    font-size: 14px;\r\n    background: #fff;\r\n    color: #333;\r\n    box-sizing: border-box;\r\n}\r\n\r\n.create-group-textarea {\r\n    width: 100%;\r\n    min-height: 80px;\r\n    padding: 8px 12px;\r\n    border: 1px solid #ddd;\r\n    border-radius: 4px;\r\n    font-size: 14px;\r\n    background: #fff;\r\n    color: #333;\r\n    resize: vertical;\r\n    font-family: inherit;\r\n    box-sizing: border-box;\r\n}\r\n\r\n.create-group-form .char-count {\r\n    font-size: 12px;\r\n    color: #666;\r\n    text-align: right;\r\n    margin-top: 2px;\r\n}\r\n\r\n.create-group-form .form-actions {\r\n    display: flex;\r\n    gap: 10px;\r\n    justify-content: flex-end;\r\n    margin-top: 10px;\r\n}\r\n\r\n.create-group-confirm {\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 8px 16px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: background-color 0.2s;\r\n}\r\n\r\n.create-group-confirm:hover:not(:disabled) {\r\n    background: #369970;\r\n}\r\n\r\n.create-group-confirm:disabled {\r\n    background: #ccc;\r\n    cursor: not-allowed;\r\n}\r\n\r\n.create-group-cancel {\r\n    background: #eee;\r\n    color: #333;\r\n    border: 1px solid #ddd;\r\n    border-radius: 4px;\r\n    padding: 8px 16px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: background-color 0.2s;\r\n}\r\n\r\n.create-group-cancel:hover {\r\n    background: #e0e0e0;\r\n}\r\n\r\n.add-group-dialog {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 8px 8px 8px 16px;\r\n    background: #f7f7f7;\r\n    border-radius: 6px;\r\n    margin: 8px 8px 0 8px;\r\n}\r\n\r\n.add-group-input {\r\n    flex: 1;\r\n    padding: 6px 8px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n    font-size: 14px;\r\n    margin-right: 8px;\r\n}\r\n\r\n.add-group-confirm {\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 10px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    margin-right: 4px;\r\n}\r\n\r\n.add-group-confirm:disabled {\r\n    background: #ccc;\r\n    cursor: not-allowed;\r\n}\r\n\r\n.add-group-cancel {\r\n    background: #eee;\r\n    color: #333;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 10px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n}\r\n\r\n.friend-item {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 10px 16px;\r\n    cursor: pointer;\r\n    border-radius: 4px;\r\n    margin: 4px 8px;\r\n    transition: background 0.2s;\r\n    background: #f8f8f8;\r\n}\r\n\r\n.group-item {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 10px 16px;\r\n    cursor: pointer;\r\n    border-radius: 4px;\r\n    margin: 4px 8px;\r\n    transition: background 0.2s;\r\n    background: #f8f8f8;\r\n}\r\n\r\n.friend-item.active,\r\n.friend-item:hover {\r\n    background: #e6f7ff;\r\n}\r\n\r\n.group-item.active,\r\n.group-item:hover {\r\n    background: #e6f7ff;\r\n}\r\n\r\n.friend-avatar {\r\n    width: 36px;\r\n    height: 36px;\r\n    margin-right: 10px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    border-radius: 50%;\r\n    background: #f0f0f0;\r\n    overflow: hidden;\r\n    font-size: 24px;\r\n}\r\n\r\n.group-avatar {\r\n    width: 36px;\r\n    height: 36px;\r\n    margin-right: 10px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    border-radius: 50%;\r\n    background: #f0f0f0;\r\n    overflow: hidden;\r\n    font-size: 24px;\r\n}\r\n\r\n.friend-info {\r\n    flex: 1;\r\n    min-width: 0;\r\n    position: relative;\r\n}\r\n\r\n.friend-name {\r\n    font-weight: bold;\r\n    font-size: 15px;\r\n}\r\n\r\n.friend-uuid {\r\n    font-size: 12px;\r\n    color: #888;\r\n    word-break: break-all;\r\n}\r\n\r\n.unread-bubble {\r\n    background: #ff4444;\r\n    color: white;\r\n    min-width: 20px;\r\n    height: 20px;\r\n    border-radius: 10px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    font-size: 12px;\r\n    padding: 0 4px;\r\n    position: relative;\r\n    right: 16px;\r\n    animation: blink 1.5s infinite;\r\n}\r\n\r\n@keyframes blink {\r\n    0%, 100% {\r\n        transform: translateX(0);\r\n    }\r\n    25% {\r\n        transform: translateX(-3px);\r\n    }\r\n    75% {\r\n        transform: translateX(3px);\r\n    }\r\n}\r\n\r\n.group-info {\r\n    flex: 1;\r\n    min-width: 0;\r\n    position: relative;\r\n}\r\n\r\n.group-name {\r\n    font-weight: bold;\r\n    font-size: 15px;\r\n}\r\n\r\n.group-uuid {\r\n    font-size: 12px;\r\n    color: #888;\r\n    word-break: break-all;\r\n}\r\n\r\n.group_unread-bubble {\r\n    background: #ff4444;\r\n    color: white;\r\n    min-width: 20px;\r\n    height: 20px;\r\n    border-radius: 10px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    font-size: 12px;\r\n    padding: 0 4px;\r\n    position: relative;\r\n    right: 16px;\r\n    animation: blink 1.5s infinite;\r\n}\r\n\r\n.friend-request-overlay {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1000;\r\n}\r\n\r\n.friend-request-dialog {\r\n    background: white;\r\n    padding: 20px;\r\n    border-radius: 8px;\r\n    width: 300px;\r\n    text-align: center;\r\n}\r\n\r\n.request-buttons {\r\n    margin-top: 20px;\r\n    display: flex;\r\n    gap: 10px;\r\n    justify-content: center;\r\n}\r\n\r\n.accept-btn {\r\n    background: #42b983;\r\n    color: white;\r\n    padding: 8px 20px;\r\n}\r\n\r\n.reject-btn {\r\n    background: #ff4444;\r\n    color: white;\r\n    padding: 8px 20px;\r\n}\r\n\r\n.friend-response-overlay {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1000;\r\n}\r\n\r\n.friend-response-dialog {\r\n    background: white;\r\n    padding: 20px;\r\n    border-radius: 8px;\r\n    width: 300px;\r\n    text-align: center;\r\n}\r\n\r\n.ok-btn {\r\n    background: #42b983;\r\n    color: white;\r\n    padding: 8px 20px;\r\n}\r\n\r\n.messages {\r\n    flex: 1;\r\n    overflow-y: auto;\r\n    padding: 16px;\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.message {\r\n    display: flex;\r\n    margin-bottom: 12px;\r\n}\r\n\r\n.message.self {\r\n    justify-content: flex-end;\r\n}\r\n\r\n.message.other {\r\n    justify-content: flex-start;\r\n}\r\n\r\n.msg-bubble {\r\n    padding: 8px 12px;\r\n    border-radius: 16px;\r\n    max-width: 80%;\r\n    word-break: break-all;\r\n    display: inline-block;\r\n    position: relative;\r\n}\r\n\r\n.message.self .msg-bubble {\r\n    background: #d1f5d3;\r\n    color: #222;\r\n    border-bottom-right-radius: 4px;\r\n    border-bottom-left-radius: 16px;\r\n    align-items: flex-end;\r\n}\r\n\r\n.message.other .msg-bubble {\r\n    background: #e6e6e6;\r\n    color: #222;\r\n    border-bottom-left-radius: 4px;\r\n    border-bottom-right-radius: 16px;\r\n    align-items: flex-start;\r\n}\r\n\r\n.sender {\r\n    font-weight: bold;\r\n    margin-right: 6px;\r\n}\r\n\r\n.timestamp {\r\n    color: #888;\r\n    font-size: 12px;\r\n    margin-left: 8px;\r\n}\r\n\r\n.input-area-wrap {\r\n    display: flex;\r\n    flex-direction: column;\r\n    border-top: 1px solid #eee;\r\n    background: #fff;\r\n    position: relative;\r\n}\r\n\r\n.input-actions-top {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    padding: 4px 0 0 0;\r\n    margin-left: 2px;\r\n    margin-bottom: 2px;\r\n    gap: 4px;\r\n}\r\n\r\n.input-area {\r\n    display: flex;\r\n    padding: 12px 0 2px 0;\r\n    background: #fff;\r\n    align-items: flex-end;\r\n}\r\n\r\n.input-action-btn {\r\n\r\n    background: none;\r\n    border: none;\r\n    font-size: 22px;\r\n    cursor: pointer;\r\n    padding: 4px 6px;\r\n    border-radius: 4px;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.input-action-btn:hover {\r\n    background: #e6f7ff;\r\n}\r\n\r\n.input-area .msg-textarea {\r\n    flex: 1;\r\n    padding: 8px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n    margin-right: 8px;\r\n    min-width: 0;\r\n    min-height: 100px;\r\n    max-height: 200px;\r\n    resize: none;\r\n    font-size: 16px;\r\n    line-height: 1.5;\r\n    overflow-y: auto;\r\n    box-sizing: border-box;\r\n    transition: height 0.2s;\r\n}\r\n\r\n.input-area button {\r\n    padding: 8px 24px;\r\n    border: none;\r\n    background: #42b983;\r\n    color: #fff;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    white-space: nowrap;\r\n    height: 40px;\r\n    align-self: flex-end;\r\n    position: absolute;\r\n    right: 16px;\r\n    bottom: 12px;\r\n    height: 40px;\r\n    padding: 8px 20px;\r\n    margin: 0;\r\n\r\n}\r\n\r\n.input-area button:hover {\r\n    background: #369870;\r\n}\r\n\r\n.nav-item.active {\r\n    background: #e6f7ff;\r\n    color: #42b983;\r\n}\r\n\r\n.search-result-list {\r\n    background: #fff;\r\n    border: 1px solid #eee;\r\n    border-radius: 6px;\r\n    margin: 8px 8px 0 8px;\r\n    padding: 6px 0;\r\n    max-height: 180px;\r\n    overflow-y: auto;\r\n}\r\n\r\n.search-result-item {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 6px 12px;\r\n    cursor: pointer;\r\n    transition: background 0.15s;\r\n    border-radius: 4px;\r\n}\r\n\r\n.search-result-item:hover {\r\n    background: #e6f7ff;\r\n}\r\n\r\n.search-avatar {\r\n    width: 32px;\r\n    height: 32px;\r\n    margin-right: 8px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    font-size: 20px;\r\n}\r\n\r\n.search-nickname {\r\n    font-weight: bold;\r\n    margin-right: 8px;\r\n}\r\n\r\n.search-uuid {\r\n    color: #888;\r\n    font-size: 12px;\r\n    margin-right: 8px;\r\n}\r\n\r\n.search-add {\r\n    color: #42b983;\r\n    font-size: 13px;\r\n}\r\n\r\n.search-error {\r\n    color: #f00;\r\n    padding: 6px 12px;\r\n}\r\n\r\n/* 设置弹窗样式 */\r\n.settings-overlay {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1000;\r\n}\r\n\r\n.settings-dialog {\r\n    background: white;\r\n    border-radius: 12px;\r\n    width: 500px;\r\n    max-width: 90vw;\r\n    max-height: 80vh;\r\n    overflow: hidden;\r\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.settings-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 20px 24px;\r\n    border-bottom: 1px solid #eee;\r\n    background: #f8f9fa;\r\n}\r\n\r\n.settings-header h3 {\r\n    margin: 0;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #333;\r\n}\r\n\r\n.close-btn {\r\n    background: none;\r\n    border: none;\r\n    font-size: 24px;\r\n    cursor: pointer;\r\n    color: #666;\r\n    padding: 0;\r\n    width: 30px;\r\n    height: 30px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    border-radius: 50%;\r\n    transition: all 0.2s;\r\n}\r\n\r\n.close-btn:hover {\r\n    background: #e9ecef;\r\n    color: #333;\r\n}\r\n\r\n.settings-content {\r\n    padding: 0;\r\n}\r\n\r\n.settings-tabs {\r\n    display: flex;\r\n    border-bottom: 1px solid #eee;\r\n    background: #f8f9fa;\r\n}\r\n\r\n.tab-btn {\r\n    flex: 1;\r\n    padding: 16px 20px;\r\n    border: none;\r\n    background: none;\r\n    cursor: pointer;\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    color: #666;\r\n    transition: all 0.2s;\r\n    border-bottom: 3px solid transparent;\r\n}\r\n\r\n.tab-btn:hover {\r\n    background: #e9ecef;\r\n    color: #333;\r\n}\r\n\r\n.tab-btn.active {\r\n    color: #42b983;\r\n    background: white;\r\n    border-bottom-color: #42b983;\r\n}\r\n\r\n.settings-panel {\r\n    padding: 24px;\r\n    max-height: 400px;\r\n    overflow-y: auto;\r\n}\r\n\r\n.form-group {\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.form-group label {\r\n    display: block;\r\n    margin-bottom: 8px;\r\n    font-weight: 500;\r\n    color: #333;\r\n    font-size: 14px;\r\n}\r\n\r\n.form-input {\r\n    width: 100%;\r\n    padding: 12px 16px;\r\n    border: 1px solid #ddd;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    transition: all 0.2s;\r\n    box-sizing: border-box;\r\n}\r\n\r\n.form-input:focus {\r\n    outline: none;\r\n    border-color: #42b983;\r\n    box-shadow: 0 0 0 3px rgba(66, 185, 131, 0.1);\r\n}\r\n\r\n.form-input:hover {\r\n    border-color: #bbb;\r\n}\r\n\r\n.form-actions {\r\n    display: flex;\r\n    gap: 12px;\r\n    margin-top: 24px;\r\n    padding-top: 20px;\r\n    border-top: 1px solid #eee;\r\n}\r\n\r\n.save-btn {\r\n    background: #42b983;\r\n    color: white;\r\n    border: none;\r\n    padding: 12px 24px;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    flex: 1;\r\n}\r\n\r\n.save-btn:hover:not(:disabled) {\r\n    background: #369870;\r\n    transform: translateY(-1px);\r\n}\r\n\r\n.save-btn:disabled {\r\n    background: #ccc;\r\n    cursor: not-allowed;\r\n    transform: none;\r\n}\r\n\r\n.cancel-btn {\r\n    background: #f8f9fa;\r\n    color: #666;\r\n    border: 1px solid #ddd;\r\n    padding: 12px 24px;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    flex: 1;\r\n}\r\n\r\n.cancel-btn:hover {\r\n    background: #e9ecef;\r\n    border-color: #bbb;\r\n    color: #333;\r\n}\r\n\r\n/* 此刻功能样式 */\r\n.moment-list-title-row {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 16px;\r\n    border-bottom: 1px solid #eee;\r\n    background: #f8f9fa;\r\n}\r\n\r\n.moment-list-title {\r\n    font-weight: bold;\r\n    font-size: 16px;\r\n    color: #333;\r\n}\r\n\r\n.add-moment-btn {\r\n    background: #42b983;\r\n    color: white;\r\n    border: none;\r\n    padding: 8px 16px;\r\n    border-radius: 6px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n}\r\n\r\n.add-moment-btn:hover {\r\n    background: #369870;\r\n    transform: translateY(-1px);\r\n}\r\n\r\n.add-moment-dialog {\r\n    padding: 16px;\r\n    background: #fff;\r\n    border-bottom: 1px solid #eee;\r\n}\r\n\r\n.add-moment-textarea {\r\n    width: 100%;\r\n    min-height: 80px;\r\n    padding: 12px;\r\n    border: 1px solid #ddd;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    line-height: 1.5;\r\n    resize: vertical;\r\n    box-sizing: border-box;\r\n    font-family: inherit;\r\n    transition: border-color 0.2s;\r\n}\r\n\r\n.add-moment-textarea:focus {\r\n    outline: none;\r\n    border-color: #42b983;\r\n    box-shadow: 0 0 0 3px rgba(66, 185, 131, 0.1);\r\n}\r\n\r\n.moment-actions {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-top: 12px;\r\n}\r\n\r\n.char-count {\r\n    font-size: 12px;\r\n    color: #888;\r\n}\r\n\r\n.publish-moment-btn {\r\n    background: #42b983;\r\n    color: white;\r\n    border: none;\r\n    padding: 8px 16px;\r\n    border-radius: 6px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    margin-right: 8px;\r\n}\r\n\r\n.publish-moment-btn:hover:not(:disabled) {\r\n    background: #369870;\r\n}\r\n\r\n.publish-moment-btn:disabled {\r\n    background: #ccc;\r\n    cursor: not-allowed;\r\n}\r\n\r\n.cancel-moment-btn {\r\n    background: #f8f9fa;\r\n    color: #666;\r\n    border: 1px solid #ddd;\r\n    padding: 8px 16px;\r\n    border-radius: 6px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n}\r\n\r\n.cancel-moment-btn:hover {\r\n    background: #e9ecef;\r\n    border-color: #bbb;\r\n}\r\n\r\n.moment-list {\r\n    max-height: 500px;\r\n    overflow-y: auto;\r\n}\r\n\r\n.moment-item {\r\n    padding: 16px;\r\n    border-bottom: 1px solid #f0f0f0;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.moment-item:hover {\r\n    background: #f8f9fa;\r\n}\r\n\r\n.moment-header {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 12px;\r\n}\r\n\r\n.moment-avatar {\r\n    width: 32px;\r\n    height: 32px;\r\n    margin-right: 12px;\r\n    border-radius: 50%;\r\n    overflow: hidden;\r\n}\r\n\r\n.moment-info {\r\n    flex: 1;\r\n}\r\n\r\n.moment-author {\r\n    font-weight: bold;\r\n    font-size: 14px;\r\n    color: #333;\r\n    margin-bottom: 2px;\r\n}\r\n\r\n.moment-time {\r\n    font-size: 12px;\r\n    color: #888;\r\n}\r\n\r\n.moment-content {\r\n    font-size: 14px;\r\n    line-height: 1.6;\r\n    color: #333;\r\n    word-break: break-word;\r\n    white-space: pre-wrap;\r\n}\r\n\r\n.moment-actions {\r\n    display: flex;\r\n    gap: 16px;\r\n    margin-top: 12px;\r\n    padding-top: 8px;\r\n    border-top: 1px solid #f0f0f0;\r\n}\r\n\r\n.moment-action-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 4px;\r\n    background: none;\r\n    border: none;\r\n    color: #666;\r\n    font-size: 13px;\r\n    cursor: pointer;\r\n    padding: 4px 8px;\r\n    border-radius: 4px;\r\n    transition: all 0.2s ease;\r\n}\r\n\r\n.moment-action-btn:hover {\r\n    background: #f5f5f5;\r\n    color: #333;\r\n}\r\n\r\n.moment-action-btn svg {\r\n    stroke-width: 1.5;\r\n}\r\n\r\n.empty-moments {\r\n    text-align: center;\r\n    padding: 60px 20px;\r\n    color: #888;\r\n}\r\n\r\n.empty-icon {\r\n    font-size: 48px;\r\n    margin-bottom: 16px;\r\n}\r\n\r\n.empty-text {\r\n    font-size: 14px;\r\n    color: #999;\r\n}\r\n\r\n/* 主题设置样式 */\r\n.theme-section {\r\n    margin-bottom: 24px;\r\n}\r\n\r\n.theme-section h4 {\r\n    margin: 0 0 16px 0;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #333;\r\n}\r\n\r\n.theme-options {\r\n    display: flex;\r\n    gap: 16px;\r\n    margin-bottom: 16px;\r\n}\r\n\r\n.theme-option {\r\n    flex: 1;\r\n    text-align: center;\r\n    cursor: pointer;\r\n    padding: 12px;\r\n    border: 2px solid #e1e5e9;\r\n    border-radius: 8px;\r\n    transition: all 0.2s;\r\n}\r\n\r\n.theme-option:hover {\r\n    border-color: #42b983;\r\n}\r\n\r\n.theme-option.active {\r\n    border-color: #42b983;\r\n    background: rgba(66, 185, 131, 0.1);\r\n}\r\n\r\n.theme-preview {\r\n    width: 60px;\r\n    height: 40px;\r\n    margin: 0 auto 8px;\r\n    border-radius: 4px;\r\n    overflow: hidden;\r\n    border: 1px solid #ddd;\r\n}\r\n\r\n.preview-header {\r\n    height: 12px;\r\n    background: #f5f5f5;\r\n}\r\n\r\n.preview-content {\r\n    height: 28px;\r\n    background: #fff;\r\n}\r\n\r\n.light-preview .preview-header {\r\n    background: #f8f9fa;\r\n}\r\n\r\n.light-preview .preview-content {\r\n    background: #ffffff;\r\n}\r\n\r\n.dark-preview .preview-header {\r\n    background: #2d3748;\r\n}\r\n\r\n.dark-preview .preview-content {\r\n    background: #1a202c;\r\n}\r\n\r\n.eye-care-preview .preview-header {\r\n    background: #f7f3e9;\r\n}\r\n\r\n.eye-care-preview .preview-content {\r\n    background: #fefcf3;\r\n}\r\n\r\n.theme-option span {\r\n    font-size: 14px;\r\n    color: #666;\r\n}\r\n\r\n.form-group label {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    font-size: 14px;\r\n    color: #333;\r\n    margin-bottom: 8px;\r\n}\r\n\r\n.form-group small {\r\n    display: block;\r\n    font-size: 12px;\r\n    color: #888;\r\n    margin-top: 4px;\r\n    margin-left: 24px;\r\n}\r\n\r\n.form-group input[type=\"checkbox\"] {\r\n    width: 16px;\r\n    height: 16px;\r\n    accent-color: #42b983;\r\n}\r\n\r\n/* 评论相关样式 */\r\n.moment-comments {\r\n    margin-top: 12px;\r\n    padding-top: 12px;\r\n    border-top: 1px solid #f0f0f0;\r\n    background: #fafafa;\r\n    border-radius: 8px;\r\n    padding: 16px;\r\n}\r\n\r\n.comment-input-area {\r\n    margin-bottom: 16px;\r\n}\r\n\r\n.comment-input {\r\n    width: 100%;\r\n    min-height: 60px;\r\n    padding: 12px;\r\n    border: 1px solid #e1e5e9;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    line-height: 1.5;\r\n    resize: vertical;\r\n    font-family: inherit;\r\n    transition: all 0.2s ease;\r\n    box-sizing: border-box;\r\n}\r\n\r\n.comment-input:focus {\r\n    outline: none;\r\n    border-color: #42b983;\r\n    box-shadow: 0 0 0 3px rgba(66, 185, 131, 0.1);\r\n}\r\n\r\n.comment-input::placeholder {\r\n    color: #999;\r\n}\r\n\r\n.comment-actions {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-top: 8px;\r\n}\r\n\r\n.comment-char-count {\r\n    font-size: 12px;\r\n    color: #888;\r\n}\r\n\r\n.submit-comment-btn {\r\n    background: #42b983;\r\n    color: white;\r\n    border: none;\r\n    padding: 8px 16px;\r\n    border-radius: 6px;\r\n    font-size: 13px;\r\n    font-weight: 500;\r\n    cursor: pointer;\r\n    transition: all 0.2s ease;\r\n}\r\n\r\n.submit-comment-btn:hover:not(:disabled) {\r\n    background: #369870;\r\n    transform: translateY(-1px);\r\n}\r\n\r\n.submit-comment-btn:disabled {\r\n    background: #ccc;\r\n    cursor: not-allowed;\r\n    transform: none;\r\n}\r\n\r\n.comments-list {\r\n    max-height: 300px;\r\n    overflow-y: auto;\r\n}\r\n\r\n.comment-item {\r\n    background: white;\r\n    border-radius: 8px;\r\n    padding: 12px;\r\n    margin-bottom: 8px;\r\n    border: 1px solid #f0f0f0;\r\n    transition: all 0.2s ease;\r\n}\r\n\r\n.comment-item:hover {\r\n    border-color: #e1e5e9;\r\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.comment-item:last-child {\r\n    margin-bottom: 0;\r\n}\r\n\r\n.comment-header {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 8px;\r\n}\r\n\r\n.comment-avatar {\r\n    width: 24px;\r\n    height: 24px;\r\n    margin-right: 8px;\r\n    border-radius: 50%;\r\n    overflow: hidden;\r\n}\r\n\r\n.comment-info {\r\n    flex: 1;\r\n}\r\n\r\n.comment-author {\r\n    font-weight: 600;\r\n    font-size: 13px;\r\n    color: #333;\r\n    margin-bottom: 2px;\r\n}\r\n\r\n.comment-time {\r\n    font-size: 11px;\r\n    color: #888;\r\n}\r\n\r\n.comment-content {\r\n    font-size: 13px;\r\n    line-height: 1.5;\r\n    color: #333;\r\n    word-break: break-word;\r\n    white-space: pre-wrap;\r\n}\r\n\r\n.empty-comments {\r\n    text-align: center;\r\n    padding: 20px;\r\n    color: #888;\r\n}\r\n\r\n.empty-comment-text {\r\n    font-size: 13px;\r\n    color: #999;\r\n}\r\n\r\n/* 评论区滚动条样式 */\r\n.comments-list::-webkit-scrollbar {\r\n    width: 4px;\r\n}\r\n\r\n.comments-list::-webkit-scrollbar-track {\r\n    background: #f1f1f1;\r\n    border-radius: 2px;\r\n}\r\n\r\n.comments-list::-webkit-scrollbar-thumb {\r\n    background: #c1c1c1;\r\n    border-radius: 2px;\r\n}\r\n\r\n.comments-list::-webkit-scrollbar-thumb:hover {\r\n    background: #a8a8a8;\r\n}\r\n</style>","import script from \"./LeftLayout.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LeftLayout.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./LeftLayout.vue?vue&type=style&index=0&id=c166fb62&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-c166fb62\"]])\n\nexport default __exports__","export function formatFileSize(bytes) {\n  const units = ['B', 'KB', 'MB', 'GB']\n  let size = bytes\n  let unitIndex = 0\n  \n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024\n    unitIndex++\n  }\n  \n  return `${size.toFixed(unitIndex === 0 ? 0 : 1)} ${units[unitIndex]}`\n}","export const emojiList = ['😄', '👧', '🦄', '🐱', '🐶', '🐼', '🐸', '🐵', '🐯', '🐰', '🦊', '🐻', '🐮', '🐷', '🐔', '🦁']\r\n","\r\nimport { ref } from 'vue';\r\n\r\nlet ws = null;\r\nexport const wsConnected = ref(false);\r\n\r\nexport function initWebSocket(sessionKey = 'default', onMessageCallback, myUuid, MessageType) {\r\n    const token = localStorage.getItem(`token_${sessionKey}`);\r\n    if (!token) {\r\n        console.error('No token found for session:', sessionKey);\r\n        wsConnected.value = false;\r\n        return;\r\n    }\r\n    const WS_URL = `ws://62.234.192.227/v1/api/webSocket/connect?token=${token}`;\r\n\r\n    ws = new WebSocket(WS_URL);\r\n    ws.binaryType = 'arraybuffer';\r\n\r\n    ws.onopen = () => {\r\n        wsConnected.value = true;\r\n        // 发送心跳消息\r\n        setInterval(() => {\r\n            if (ws && ws.readyState === WebSocket.OPEN) {\r\n                // 消息体\r\n                const msgObj = {\r\n                    to: myUuid,\r\n                    type: 'ping',\r\n                    messageType: 1, // 单聊或群聊\r\n                }\r\n                const errMsg = MessageType.verify(msgObj)\r\n                if (errMsg) {\r\n                    console.error('Message verification failed:', errMsg)\r\n                    return\r\n                }\r\n                const messageBuffer = MessageType.encode(MessageType.create(msgObj)).finish()\r\n                ws.send(messageBuffer)\r\n            }\r\n        }, 30000);\r\n    };\r\n\r\n    ws.onclose = () => {\r\n        wsConnected.value = false;\r\n    };\r\n\r\n    if (onMessageCallback) {\r\n        ws.onmessage = onMessageCallback;\r\n    }\r\n}\r\n\r\nexport function getWebSocket() {\r\n    return ws;\r\n}\r\n\r\nexport function closeWebSocket() {\r\n    if (ws) {\r\n        ws.close();\r\n    }\r\n}","<template>\r\n  <div v-if=\"showCallInterface\" class=\"voice-call-overlay\">\r\n    <!-- 来电界面 -->\r\n    <div v-if=\"callState === 'incoming'\" class=\"call-interface incoming-call\">\r\n      <div class=\"caller-info\">\r\n        <div class=\"caller-avatar\">📞</div>\r\n        <h3>{{ callerName }}</h3>\r\n        <p>语音通话邀请</p>\r\n      </div>\r\n      <div class=\"call-actions\">\r\n        <button @click=\"acceptCall\" class=\"accept-btn\">接听</button>\r\n        <button @click=\"rejectCall\" class=\"reject-btn\">拒绝</button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 拨号界面 -->\r\n    <div v-if=\"callState === 'calling'\" class=\"call-interface outgoing-call\">\r\n      <div class=\"caller-info\">\r\n        <div class=\"caller-avatar\">📞</div>\r\n        <h3>{{ targetName }}</h3>\r\n        <p>正在呼叫...</p>\r\n      </div>\r\n      <div class=\"call-actions\">\r\n        <button @click=\"hangUp\" class=\"reject-btn\">挂断</button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 通话中界面 -->\r\n    <div v-if=\"callState === 'connected'\" class=\"call-interface active-call\">\r\n      <div class=\"caller-info\">\r\n        <div class=\"caller-avatar\">🔊</div>\r\n        <h3>{{ targetName || callerName }}</h3>\r\n        <p>通话中 {{ formatCallDuration(callDuration) }}</p>\r\n      </div>\r\n      <div class=\"call-controls\">\r\n        <button @click=\"toggleMute\" :class=\"{ active: isMuted }\" class=\"control-btn\">\r\n          {{ isMuted ? '🔇' : '🎤' }}\r\n        </button>\r\n        <button @click=\"toggleSpeaker\" :class=\"{ active: isSpeakerOn }\" class=\"control-btn\">\r\n          {{ isSpeakerOn ? '🔊' : '🔈' }}\r\n        </button>\r\n        <button @click=\"hangUp\" class=\"reject-btn\">挂断</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, onBeforeUnmount } from 'vue'\r\nimport { getWebSocket } from './websocket'\r\n\r\n// Props\r\nconst props = defineProps({\r\n  myUuid: String,\r\n  myName: String,\r\n  messageType: Object\r\n})\r\n\r\n// Emits\r\nconst emit = defineEmits(['call-ended', 'call-started'])\r\n\r\n// 响应式数据\r\nconst showCallInterface = ref(false)\r\nconst callState = ref('idle') // idle, calling, incoming, connected\r\nconst callerName = ref('')\r\nconst targetName = ref('')\r\nconst targetUuid = ref('')\r\nconst isMuted = ref(false)\r\nconst isSpeakerOn = ref(false)\r\nconst callDuration = ref(0)\r\nconst callTimer = ref(null)\r\n\r\n// WebRTC相关\r\nconst localStream = ref(null)\r\nconst remoteStream = ref(null)\r\nconst peerConnection = ref(null)\r\nconst iceCandidates = ref([])\r\n\r\n// WebRTC配置\r\nconst rtcConfiguration = {\r\n  iceServers: [\r\n    { urls: 'stun:stun.l.google.com:19302' },\r\n    { urls: 'stun:stun1.l.google.com:19302' }\r\n  ]\r\n}\r\n\r\n// 计算属性\r\nconst formatCallDuration = computed(() => {\r\n  return (duration) => {\r\n    const minutes = Math.floor(duration / 60)\r\n    const seconds = duration % 60\r\n    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\r\n  }\r\n})\r\n\r\n// 初始化WebRTC\r\nasync function initWebRTC() {\r\n  try {\r\n    // 获取用户媒体（仅音频）\r\n    localStream.value = await navigator.mediaDevices.getUserMedia({ \r\n      audio: true, \r\n      video: false \r\n    })\r\n    \r\n    // 创建RTCPeerConnection\r\n    peerConnection.value = new RTCPeerConnection(rtcConfiguration)\r\n    \r\n    // 添加本地流\r\n    localStream.value.getTracks().forEach(track => {\r\n      peerConnection.value.addTrack(track, localStream.value)\r\n    })\r\n    \r\n    // 监听远程流\r\n    peerConnection.value.ontrack = (event) => {\r\n      remoteStream.value = event.streams[0]\r\n      playRemoteAudio()\r\n    }\r\n    \r\n    // 监听ICE候选\r\n    peerConnection.value.onicecandidate = (event) => {\r\n      if (event.candidate) {\r\n        sendSignalingMessage({\r\n          type: 'ice-candidate',\r\n          candidate: event.candidate\r\n        })\r\n      }\r\n    }\r\n    \r\n    // 监听连接状态\r\n    peerConnection.value.onconnectionstatechange = () => {\r\n      console.log('Connection state:', peerConnection.value.connectionState)\r\n      if (peerConnection.value.connectionState === 'connected') {\r\n        callState.value = 'connected'\r\n        startCallTimer()\r\n      } else if (peerConnection.value.connectionState === 'disconnected' || \r\n                 peerConnection.value.connectionState === 'failed') {\r\n        endCall()\r\n      }\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('初始化WebRTC失败:', error)\r\n    alert('无法访问麦克风，请检查权限设置')\r\n  }\r\n}\r\n\r\n// 发起语音通话\r\nasync function startCall(uuid, name) {\r\n  targetUuid.value = uuid\r\n  targetName.value = name\r\n  callState.value = 'calling'\r\n  showCallInterface.value = true\r\n  \r\n  await initWebRTC()\r\n  \r\n  // 发送通话邀请\r\n  sendSignalingMessage({\r\n    type: 'call-invite',\r\n    from: props.myUuid,\r\n    fromName: props.myName,\r\n    to: uuid\r\n  })\r\n  \r\n  emit('call-started')\r\n}\r\n\r\n// 接听电话\r\nasync function acceptCall() {\r\n  await initWebRTC()\r\n  \r\n  // 发送接受通话消息\r\n  sendSignalingMessage({\r\n    type: 'call-accept',\r\n    from: props.myUuid,\r\n    to: targetUuid.value\r\n  })\r\n  \r\n  callState.value = 'connected'\r\n}\r\n\r\n// 拒绝电话\r\nfunction rejectCall() {\r\n  sendSignalingMessage({\r\n    type: 'call-reject',\r\n    from: props.myUuid,\r\n    to: targetUuid.value\r\n  })\r\n  \r\n  endCall()\r\n}\r\n\r\n// 挂断电话\r\nfunction hangUp() {\r\n  sendSignalingMessage({\r\n    type: 'call-hangup',\r\n    from: props.myUuid,\r\n    to: targetUuid.value\r\n  })\r\n  \r\n  endCall()\r\n}\r\n\r\n// 结束通话\r\nfunction endCall() {\r\n  // 停止计时器\r\n  if (callTimer.value) {\r\n    clearInterval(callTimer.value)\r\n    callTimer.value = null\r\n  }\r\n  \r\n  // 关闭媒体流\r\n  if (localStream.value) {\r\n    localStream.value.getTracks().forEach(track => track.stop())\r\n    localStream.value = null\r\n  }\r\n  \r\n  // 关闭RTCPeerConnection\r\n  if (peerConnection.value) {\r\n    peerConnection.value.close()\r\n    peerConnection.value = null\r\n  }\r\n  \r\n  // 重置状态\r\n  callState.value = 'idle'\r\n  showCallInterface.value = false\r\n  callDuration.value = 0\r\n  callerName.value = ''\r\n  targetName.value = ''\r\n  targetUuid.value = ''\r\n  isMuted.value = false\r\n  isSpeakerOn.value = false\r\n  \r\n  emit('call-ended')\r\n}\r\n\r\n// 切换静音\r\nfunction toggleMute() {\r\n  if (localStream.value) {\r\n    const audioTrack = localStream.value.getAudioTracks()[0]\r\n    if (audioTrack) {\r\n      audioTrack.enabled = !audioTrack.enabled\r\n      isMuted.value = !audioTrack.enabled\r\n    }\r\n  }\r\n}\r\n\r\n// 切换扬声器（在实际应用中可能需要更复杂的实现）\r\nfunction toggleSpeaker() {\r\n  isSpeakerOn.value = !isSpeakerOn.value\r\n  // 这里可以添加实际的扬声器切换逻辑\r\n}\r\n\r\n// 播放远程音频\r\nfunction playRemoteAudio() {\r\n  if (remoteStream.value) {\r\n    const audioElement = new Audio()\r\n    audioElement.srcObject = remoteStream.value\r\n    audioElement.play().catch(console.error)\r\n  }\r\n}\r\n\r\n// 开始通话计时\r\nfunction startCallTimer() {\r\n  callTimer.value = setInterval(() => {\r\n    callDuration.value++\r\n  }, 1000)\r\n}\r\n\r\n// 发送信令消息\r\nfunction sendSignalingMessage(message) {\r\n  const ws = getWebSocket()\r\n  console.log('ws:', ws)\r\n  console.log('props.messageType:', props.messageType)\r\n  if (ws && ws.readyState === WebSocket.OPEN && props.messageType) {\r\n    console.log('已经满足')\r\n    const msgObj = {\r\n      avatar: '',\r\n      fromUsername: props.myName,\r\n      from: props.myUuid,\r\n      to: message.to || targetUuid.value,\r\n      content: JSON.stringify(message),\r\n      contentType: 6, // 新增：WebRTC信令消息类型\r\n      type: 'webrtc-signal',\r\n      messageType: 1,\r\n      url: '',\r\n      fileSuffix: '',\r\n      file: new Uint8Array()\r\n    }\r\n    \r\n    const errMsg = props.messageType.verify(msgObj)\r\n    if (errMsg) {\r\n      console.error('信令消息格式错误:', errMsg)\r\n      return\r\n    }\r\n    console.log('信令消息:', msgObj)\r\n\r\n    \r\n    const messageBuffer = props.messageType.encode(props.messageType.create(msgObj)).finish()\r\n    ws.send(messageBuffer)\r\n  }\r\n}\r\n\r\n// 处理信令消息\r\nfunction handleSignalingMessage(message) {\r\n  const signalData = JSON.parse(message.content)\r\n  console.log(\"处理信令消息:\", signalData)\r\n\r\n  switch (signalData.type) {\r\n    case 'call-invite':\r\n      // 收到通话邀请\r\n      callerName.value = signalData.fromName\r\n      targetUuid.value = signalData.from\r\n      callState.value = 'incoming'\r\n      showCallInterface.value = true\r\n      break\r\n      \r\n    case 'call-accept':\r\n      // 对方接受通话\r\n      createOffer()\r\n      break\r\n      \r\n    case 'call-reject':\r\n      // 对方拒绝通话\r\n      alert('对方拒绝了通话')\r\n      endCall()\r\n      break\r\n      \r\n    case 'call-hangup':\r\n      // 对方挂断通话\r\n      endCall()\r\n      break\r\n      \r\n    case 'offer':\r\n      handleOffer(signalData.offer)\r\n      break\r\n      \r\n    case 'answer':\r\n      handleAnswer(signalData.answer)\r\n      break\r\n      \r\n    case 'ice-candidate':\r\n      handleIceCandidate(signalData.candidate)\r\n      break\r\n  }\r\n}\r\n\r\n// 创建Offer\r\nasync function createOffer() {\r\n  try {\r\n    const offer = await peerConnection.value.createOffer()\r\n    await peerConnection.value.setLocalDescription(offer)\r\n    \r\n    sendSignalingMessage({\r\n      type: 'offer',\r\n      offer: offer\r\n    })\r\n  } catch (error) {\r\n    console.error('创建Offer失败:', error)\r\n  }\r\n}\r\n\r\n// 处理Offer\r\nasync function handleOffer(offer) {\r\n  try {\r\n    await peerConnection.value.setRemoteDescription(offer)\r\n    \r\n    const answer = await peerConnection.value.createAnswer()\r\n    await peerConnection.value.setLocalDescription(answer)\r\n    \r\n    sendSignalingMessage({\r\n      type: 'answer',\r\n      answer: answer\r\n    })\r\n  } catch (error) {\r\n    console.error('处理Offer失败:', error)\r\n  }\r\n}\r\n\r\n// 处理Answer\r\nasync function handleAnswer(answer) {\r\n  try {\r\n    await peerConnection.value.setRemoteDescription(answer)\r\n  } catch (error) {\r\n    console.error('处理Answer失败:', error)\r\n  }\r\n}\r\n\r\n// 处理ICE候选\r\nasync function handleIceCandidate(candidate) {\r\n  try {\r\n    await peerConnection.value.addIceCandidate(candidate)\r\n  } catch (error) {\r\n    console.error('添加ICE候选失败:', error)\r\n  }\r\n}\r\n\r\n// 暴露方法给父组件\r\ndefineExpose({\r\n  startCall,\r\n  handleSignalingMessage,\r\n  endCall\r\n})\r\n\r\n// 组件卸载时清理资源\r\nonBeforeUnmount(() => {\r\n  endCall()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.voice-call-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.8);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.call-interface {\r\n  background: white;\r\n  border-radius: 20px;\r\n  padding: 40px;\r\n  text-align: center;\r\n  min-width: 300px;\r\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.caller-info {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.caller-avatar {\r\n  font-size: 60px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.caller-info h3 {\r\n  margin: 0 0 10px 0;\r\n  font-size: 24px;\r\n  color: #333;\r\n}\r\n\r\n.caller-info p {\r\n  margin: 0;\r\n  color: #666;\r\n  font-size: 16px;\r\n}\r\n\r\n.call-actions {\r\n  display: flex;\r\n  gap: 20px;\r\n  justify-content: center;\r\n}\r\n\r\n.call-controls {\r\n  display: flex;\r\n  gap: 15px;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.accept-btn {\r\n  background: #4CAF50;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 50px;\r\n  padding: 15px 30px;\r\n  font-size: 16px;\r\n  cursor: pointer;\r\n  transition: background 0.3s;\r\n}\r\n\r\n.accept-btn:hover {\r\n  background: #45a049;\r\n}\r\n\r\n.reject-btn {\r\n  background: #f44336;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 50px;\r\n  padding: 15px 30px;\r\n  font-size: 16px;\r\n  cursor: pointer;\r\n  transition: background 0.3s;\r\n}\r\n\r\n.reject-btn:hover {\r\n  background: #da190b;\r\n}\r\n\r\n.control-btn {\r\n  background: #f0f0f0;\r\n  border: none;\r\n  border-radius: 50%;\r\n  width: 50px;\r\n  height: 50px;\r\n  font-size: 20px;\r\n  cursor: pointer;\r\n  transition: background 0.3s;\r\n}\r\n\r\n.control-btn:hover {\r\n  background: #e0e0e0;\r\n}\r\n\r\n.control-btn.active {\r\n  background: #2196F3;\r\n  color: white;\r\n}\r\n\r\n.incoming-call {\r\n  animation: pulse 2s infinite;\r\n}\r\n\r\n@keyframes pulse {\r\n  0% {\r\n    transform: scale(1);\r\n  }\r\n  50% {\r\n    transform: scale(1.05);\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n  }\r\n}\r\n</style>","import script from \"./WebRTCVoiceCall.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./WebRTCVoiceCall.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./WebRTCVoiceCall.vue?vue&type=style&index=0&id=170031f3&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-170031f3\"]])\n\nexport default __exports__","<template>\n  <div v-if=\"showCallInterface\" class=\"video-call-overlay\">\n    <!-- 来电界面 -->\n    <div v-if=\"callState === 'incoming'\" class=\"call-interface incoming-call\">\n      <div class=\"caller-info\">\n        <div class=\"caller-avatar\">📹</div>\n        <h3>{{ callerName }}</h3>\n        <p>视频通话邀请</p>\n      </div>\n      <div class=\"call-actions\">\n        <button @click=\"acceptCall\" class=\"accept-btn\">接听</button>\n        <button @click=\"rejectCall\" class=\"reject-btn\">拒绝</button>\n      </div>\n    </div>\n\n    <!-- 拨号界面 -->\n    <div v-if=\"callState === 'calling'\" class=\"call-interface outgoing-call\">\n      <div class=\"caller-info\">\n        <div class=\"caller-avatar\">📹</div>\n        <h3>{{ targetName }}</h3>\n        <p>正在呼叫...</p>\n      </div>\n      <div class=\"call-actions\">\n        <button @click=\"hangUp\" class=\"reject-btn\">挂断</button>\n      </div>\n    </div>\n\n    <!-- 通话中界面 -->\n    <div v-if=\"callState === 'connected'\" class=\"video-call-interface\">\n      <!-- 远程视频（主画面） -->\n      <div class=\"remote-video-container\">\n        <video \n          ref=\"remoteVideo\" \n          class=\"remote-video\" \n          autoplay \n          playsinline\n          :muted=\"false\"\n        ></video>\n        \n        <!-- 通话信息覆盖层 -->\n        <div class=\"call-info-overlay\">\n          <div class=\"caller-name\">{{ targetName || callerName }}</div>\n          <div class=\"call-duration\">{{ formatCallDuration(callDuration) }}</div>\n        </div>\n      </div>\n      \n      <!-- 本地视频（小窗口） -->\n      <div class=\"local-video-container\" :class=\"{ minimized: isLocalVideoMinimized }\">\n        <video \n          ref=\"localVideo\" \n          class=\"local-video\" \n          autoplay \n          playsinline \n          muted\n        ></video>\n        <button @click=\"toggleLocalVideoSize\" class=\"toggle-size-btn\">⤢</button>\n      </div>\n      \n      <!-- 控制按钮 -->\n      <div class=\"video-call-controls\">\n        <button @click=\"toggleMute\" :class=\"{ active: isMuted }\" class=\"control-btn\" title=\"静音\">\n          {{ isMuted ? '🔇' : '🎤' }}\n        </button>\n        \n        <button @click=\"toggleVideo\" :class=\"{ active: !isVideoEnabled }\" class=\"control-btn\" title=\"关闭摄像头\">\n          {{ isVideoEnabled ? '📹' : '📷' }}\n        </button>\n        \n        <button @click=\"switchCamera\" class=\"control-btn\" title=\"切换摄像头\" v-if=\"hasMultipleCameras\">\n          🔄\n        </button>\n        \n        <button @click=\"toggleSpeaker\" :class=\"{ active: isSpeakerOn }\" class=\"control-btn\" title=\"扬声器\">\n          {{ isSpeakerOn ? '🔊' : '🔈' }}\n        </button>\n        \n        <button @click=\"hangUp\" class=\"reject-btn\" title=\"挂断\">📞</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onBeforeUnmount, nextTick } from 'vue'\nimport { getWebSocket } from './websocket'\n\n// Props\nconst props = defineProps({\n  myUuid: String,\n  myName: String,\n  messageType: Object\n})\n\n// Emits\nconst emit = defineEmits(['call-ended', 'call-started'])\n\n// 响应式数据\nconst showCallInterface = ref(false)\nconst callState = ref('idle') // idle, calling, incoming, connected\nconst callerName = ref('')\nconst targetName = ref('')\nconst targetUuid = ref('')\nconst isMuted = ref(false)\nconst isVideoEnabled = ref(true)\nconst isSpeakerOn = ref(false)\nconst isLocalVideoMinimized = ref(false)\nconst hasMultipleCameras = ref(false)\nconst currentCameraIndex = ref(0)\nconst availableCameras = ref([])\nconst callDuration = ref(0)\nconst callTimer = ref(null)\n\n// 视频元素引用\nconst localVideo = ref(null)\nconst remoteVideo = ref(null)\n\n// WebRTC相关\nconst localStream = ref(null)\nconst remoteStream = ref(null)\nconst peerConnection = ref(null)\nconst iceCandidates = ref([])\n\n// WebRTC配置\nconst rtcConfiguration = {\n  iceServers: [\n    { urls: 'stun:stun.l.google.com:19302' },\n    { urls: 'stun:stun1.l.google.com:19302' }\n  ]\n}\n\n// 计算属性\nconst formatCallDuration = computed(() => {\n  return (duration) => {\n    const minutes = Math.floor(duration / 60)\n    const seconds = duration % 60\n    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\n  }\n})\n\n// 获取可用摄像头\nasync function getAvailableCameras() {\n  try {\n    const devices = await navigator.mediaDevices.enumerateDevices()\n    availableCameras.value = devices.filter(device => device.kind === 'videoinput')\n    hasMultipleCameras.value = availableCameras.value.length > 1\n  } catch (error) {\n    console.error('获取摄像头列表失败:', error)\n  }\n}\n\n// 初始化WebRTC\nasync function initWebRTC() {\n  try {\n    // 获取用户媒体（音频和视频）\n    const constraints = {\n      audio: true,\n      video: {\n        width: { ideal: 1280 },\n        height: { ideal: 720 },\n        frameRate: { ideal: 30 },\n        facingMode: 'user'\n      }\n    }\n    \n    localStream.value = await navigator.mediaDevices.getUserMedia(constraints)\n    \n    // 设置本地视频\n    await nextTick()\n    if (localVideo.value) {\n      localVideo.value.srcObject = localStream.value\n    }\n    \n    // 创建RTCPeerConnection\n    peerConnection.value = new RTCPeerConnection(rtcConfiguration)\n    \n    // 添加本地流\n    localStream.value.getTracks().forEach(track => {\n      peerConnection.value.addTrack(track, localStream.value)\n    })\n    \n    // 监听远程流\n    peerConnection.value.ontrack = (event) => {\n      remoteStream.value = event.streams[0]\n      playRemoteVideo()\n    }\n    \n    // 监听ICE候选\n    peerConnection.value.onicecandidate = (event) => {\n      if (event.candidate) {\n        sendSignalingMessage({\n          type: 'ice-candidate',\n          candidate: event.candidate\n        })\n      }\n    }\n    \n    // 监听连接状态\n    peerConnection.value.onconnectionstatechange = () => {\n      console.log('Connection state:', peerConnection.value.connectionState)\n      if (peerConnection.value.connectionState === 'connected') {\n        callState.value = 'connected'\n        startCallTimer()\n      } else if (peerConnection.value.connectionState === 'disconnected' || \n                 peerConnection.value.connectionState === 'failed') {\n        endCall()\n      }\n    }\n    \n    // 获取可用摄像头\n    await getAvailableCameras()\n    \n  } catch (error) {\n    console.error('初始化WebRTC失败:', error)\n    alert('无法访问摄像头或麦克风，请检查权限设置')\n  }\n}\n\n// 发起视频通话\nasync function startCall(uuid, name) {\n  targetUuid.value = uuid\n  targetName.value = name\n  callState.value = 'calling'\n  showCallInterface.value = true\n  \n  await initWebRTC()\n  \n  // 发送通话邀请\n  sendSignalingMessage({\n    type: 'video-call-invite',\n    from: props.myUuid,\n    fromName: props.myName,\n    to: uuid\n  })\n  \n  emit('call-started')\n}\n\n// 接听电话\nasync function acceptCall() {\n  await initWebRTC()\n  \n  // 发送接受通话消息\n  sendSignalingMessage({\n    type: 'video-call-accept',\n    from: props.myUuid,\n    to: targetUuid.value\n  })\n  \n  callState.value = 'connected'\n}\n\n// 拒绝电话\nfunction rejectCall() {\n  sendSignalingMessage({\n    type: 'video-call-reject',\n    from: props.myUuid,\n    to: targetUuid.value\n  })\n  \n  endCall()\n}\n\n// 挂断电话\nfunction hangUp() {\n  sendSignalingMessage({\n    type: 'video-call-hangup',\n    from: props.myUuid,\n    to: targetUuid.value\n  })\n  \n  endCall()\n}\n\n// 结束通话\nfunction endCall() {\n  // 停止计时器\n  if (callTimer.value) {\n    clearInterval(callTimer.value)\n    callTimer.value = null\n  }\n  \n  // 关闭媒体流\n  if (localStream.value) {\n    localStream.value.getTracks().forEach(track => track.stop())\n    localStream.value = null\n  }\n  \n  // 清理视频元素\n  if (localVideo.value) {\n    localVideo.value.srcObject = null\n  }\n  if (remoteVideo.value) {\n    remoteVideo.value.srcObject = null\n  }\n  \n  // 关闭RTCPeerConnection\n  if (peerConnection.value) {\n    peerConnection.value.close()\n    peerConnection.value = null\n  }\n  \n  // 重置状态\n  callState.value = 'idle'\n  showCallInterface.value = false\n  callDuration.value = 0\n  callerName.value = ''\n  targetName.value = ''\n  targetUuid.value = ''\n  isMuted.value = false\n  isVideoEnabled.value = true\n  isSpeakerOn.value = false\n  isLocalVideoMinimized.value = false\n  \n  emit('call-ended')\n}\n\n// 切换静音\nfunction toggleMute() {\n  if (localStream.value) {\n    const audioTrack = localStream.value.getAudioTracks()[0]\n    if (audioTrack) {\n      audioTrack.enabled = !audioTrack.enabled\n      isMuted.value = !audioTrack.enabled\n    }\n  }\n}\n\n// 切换视频\nfunction toggleVideo() {\n  if (localStream.value) {\n    const videoTrack = localStream.value.getVideoTracks()[0]\n    if (videoTrack) {\n      videoTrack.enabled = !videoTrack.enabled\n      isVideoEnabled.value = videoTrack.enabled\n    }\n  }\n}\n\n// 切换摄像头\nasync function switchCamera() {\n  if (!hasMultipleCameras.value || !localStream.value) return\n  \n  try {\n    // 停止当前视频轨道\n    const videoTrack = localStream.value.getVideoTracks()[0]\n    if (videoTrack) {\n      videoTrack.stop()\n    }\n    \n    // 切换到下一个摄像头\n    currentCameraIndex.value = (currentCameraIndex.value + 1) % availableCameras.value.length\n    const selectedCamera = availableCameras.value[currentCameraIndex.value]\n    \n    // 获取新的视频流\n    const newVideoStream = await navigator.mediaDevices.getUserMedia({\n      video: {\n        deviceId: { exact: selectedCamera.deviceId },\n        width: { ideal: 1280 },\n        height: { ideal: 720 },\n        frameRate: { ideal: 30 }\n      }\n    })\n    \n    // 替换视频轨道\n    const newVideoTrack = newVideoStream.getVideoTracks()[0]\n    const sender = peerConnection.value.getSenders().find(s => \n      s.track && s.track.kind === 'video'\n    )\n    \n    if (sender) {\n      await sender.replaceTrack(newVideoTrack)\n    }\n    \n    // 更新本地流\n    const audioTrack = localStream.value.getAudioTracks()[0]\n    localStream.value = new MediaStream([audioTrack, newVideoTrack])\n    \n    // 更新本地视频显示\n    if (localVideo.value) {\n      localVideo.value.srcObject = localStream.value\n    }\n    \n  } catch (error) {\n    console.error('切换摄像头失败:', error)\n  }\n}\n\n// 切换扬声器\nfunction toggleSpeaker() {\n  isSpeakerOn.value = !isSpeakerOn.value\n  // 这里可以添加实际的扬声器切换逻辑\n}\n\n// 切换本地视频窗口大小\nfunction toggleLocalVideoSize() {\n  isLocalVideoMinimized.value = !isLocalVideoMinimized.value\n}\n\n// 播放远程视频\nfunction playRemoteVideo() {\n  if (remoteStream.value && remoteVideo.value) {\n    remoteVideo.value.srcObject = remoteStream.value\n  }\n}\n\n// 开始通话计时\nfunction startCallTimer() {\n  callTimer.value = setInterval(() => {\n    callDuration.value++\n  }, 1000)\n}\n\n// 发送信令消息\nfunction sendSignalingMessage(message) {\n  const ws = getWebSocket()\n  if (ws && ws.readyState === WebSocket.OPEN && props.messageType) {\n    const msgObj = {\n      avatar: '',\n      fromUsername: props.myName,\n      from: props.myUuid,\n      to: message.to || targetUuid.value,\n      content: JSON.stringify(message),\n      contentType: 7, // 新增：WebRTC视频信令消息类型\n      type: 'webrtc-video-signal',\n      messageType: 1,\n      url: '',\n      fileSuffix: '',\n      file: new Uint8Array()\n    }\n    \n    const errMsg = props.messageType.verify(msgObj)\n    if (errMsg) {\n      console.error('信令消息格式错误:', errMsg)\n      return\n    }\n    \n    const messageBuffer = props.messageType.encode(props.messageType.create(msgObj)).finish()\n    ws.send(messageBuffer)\n  }\n}\n\n// 处理信令消息\nfunction handleSignalingMessage(message) {\n  const signalData = JSON.parse(message.content)\n  console.log(\"处理视频信令消息:\", signalData)\n\n  switch (signalData.type) {\n    case 'video-call-invite':\n      // 收到视频通话邀请\n      callerName.value = signalData.fromName\n      targetUuid.value = signalData.from\n      callState.value = 'incoming'\n      showCallInterface.value = true\n      break\n      \n    case 'video-call-accept':\n      // 对方接受通话\n      createOffer()\n      break\n      \n    case 'video-call-reject':\n      // 对方拒绝通话\n      alert('对方拒绝了视频通话')\n      endCall()\n      break\n      \n    case 'video-call-hangup':\n      // 对方挂断通话\n      endCall()\n      break\n      \n    case 'offer':\n      handleOffer(signalData.offer)\n      break\n      \n    case 'answer':\n      handleAnswer(signalData.answer)\n      break\n      \n    case 'ice-candidate':\n      handleIceCandidate(signalData.candidate)\n      break\n  }\n}\n\n// 创建Offer\nasync function createOffer() {\n  try {\n    const offer = await peerConnection.value.createOffer()\n    await peerConnection.value.setLocalDescription(offer)\n    \n    sendSignalingMessage({\n      type: 'offer',\n      offer: offer\n    })\n  } catch (error) {\n    console.error('创建Offer失败:', error)\n  }\n}\n\n// 处理Offer\nasync function handleOffer(offer) {\n  try {\n    await peerConnection.value.setRemoteDescription(offer)\n    \n    const answer = await peerConnection.value.createAnswer()\n    await peerConnection.value.setLocalDescription(answer)\n    \n    sendSignalingMessage({\n      type: 'answer',\n      answer: answer\n    })\n  } catch (error) {\n    console.error('处理Offer失败:', error)\n  }\n}\n\n// 处理Answer\nasync function handleAnswer(answer) {\n  try {\n    await peerConnection.value.setRemoteDescription(answer)\n  } catch (error) {\n    console.error('处理Answer失败:', error)\n  }\n}\n\n// 处理ICE候选\nasync function handleIceCandidate(candidate) {\n  try {\n    await peerConnection.value.addIceCandidate(candidate)\n  } catch (error) {\n    console.error('添加ICE候选失败:', error)\n  }\n}\n\n// 暴露方法给父组件\ndefineExpose({\n  startCall,\n  handleSignalingMessage,\n  endCall\n})\n\n// 组件卸载时清理\nonBeforeUnmount(() => {\n  endCall()\n})\n</script>\n\n<style scoped>\n.video-call-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.9);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n\n.call-interface {\n  background: white;\n  border-radius: 20px;\n  padding: 40px;\n  text-align: center;\n  min-width: 300px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n}\n\n.video-call-interface {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n}\n\n.remote-video-container {\n  flex: 1;\n  position: relative;\n  background: #000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.remote-video {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.call-info-overlay {\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  color: white;\n  z-index: 10;\n}\n\n.caller-name {\n  font-size: 24px;\n  font-weight: bold;\n  margin-bottom: 5px;\n  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);\n}\n\n.call-duration {\n  font-size: 16px;\n  opacity: 0.9;\n  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);\n}\n\n.local-video-container {\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  width: 200px;\n  height: 150px;\n  background: #000;\n  border-radius: 10px;\n  overflow: hidden;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  transition: all 0.3s ease;\n  z-index: 10;\n}\n\n.local-video-container.minimized {\n  width: 120px;\n  height: 90px;\n}\n\n.local-video {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.toggle-size-btn {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n  background: rgba(0, 0, 0, 0.5);\n  color: white;\n  border: none;\n  border-radius: 50%;\n  width: 25px;\n  height: 25px;\n  font-size: 12px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.video-call-controls {\n  position: absolute;\n  bottom: 30px;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  gap: 15px;\n  background: rgba(0, 0, 0, 0.7);\n  padding: 15px 25px;\n  border-radius: 50px;\n  backdrop-filter: blur(10px);\n}\n\n.caller-info {\n  margin-bottom: 30px;\n}\n\n.caller-avatar {\n  font-size: 60px;\n  margin-bottom: 15px;\n}\n\n.caller-info h3 {\n  margin: 0 0 10px 0;\n  font-size: 24px;\n  color: #333;\n}\n\n.caller-info p {\n  margin: 0;\n  color: #666;\n  font-size: 16px;\n}\n\n.call-actions {\n  display: flex;\n  gap: 20px;\n  justify-content: center;\n}\n\n.accept-btn {\n  background: #4CAF50;\n  color: white;\n  border: none;\n  border-radius: 50px;\n  padding: 15px 30px;\n  font-size: 16px;\n  cursor: pointer;\n  transition: background 0.3s;\n}\n\n.accept-btn:hover {\n  background: #45a049;\n}\n\n.reject-btn {\n  background: #f44336;\n  color: white;\n  border: none;\n  border-radius: 50%;\n  width: 60px;\n  height: 60px;\n  font-size: 20px;\n  cursor: pointer;\n  transition: background 0.3s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.reject-btn:hover {\n  background: #da190b;\n}\n\n.control-btn {\n  background: rgba(255, 255, 255, 0.2);\n  color: white;\n  border: none;\n  border-radius: 50%;\n  width: 50px;\n  height: 50px;\n  font-size: 20px;\n  cursor: pointer;\n  transition: all 0.3s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.control-btn:hover {\n  background: rgba(255, 255, 255, 0.3);\n  transform: scale(1.1);\n}\n\n.control-btn.active {\n  background: #f44336;\n}\n\n.incoming-call {\n  animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n  0% {\n    transform: scale(1);\n  }\n  50% {\n    transform: scale(1.05);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .local-video-container {\n    width: 120px;\n    height: 90px;\n    top: 10px;\n    right: 10px;\n  }\n  \n  .local-video-container.minimized {\n    width: 80px;\n    height: 60px;\n  }\n  \n  .video-call-controls {\n    bottom: 20px;\n    padding: 10px 20px;\n  }\n  \n  .control-btn {\n    width: 45px;\n    height: 45px;\n    font-size: 18px;\n  }\n  \n  .reject-btn {\n    width: 50px;\n    height: 50px;\n    font-size: 18px;\n  }\n  \n  .call-info-overlay {\n    top: 10px;\n    left: 10px;\n  }\n  \n  .caller-name {\n    font-size: 20px;\n  }\n  \n  .call-duration {\n    font-size: 14px;\n  }\n}\n</style>","import script from \"./WebRTCVideoCall.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./WebRTCVideoCall.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./WebRTCVideoCall.vue?vue&type=style&index=0&id=9c5bcdf8&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-9c5bcdf8\"]])\n\nexport default __exports__","import { ref, nextTick } from 'vue'\nimport { getWebSocket } from './websocket'\n\n// ACK管理器类\nclass ACKManager {\n    constructor() {\n        this.pendingAcks = new Set() // 待发送ACK的消息ID集合\n        this.ackTimer = null // ACK发送定时器\n        this.ackDelay = 1000 // ACK发送延迟（毫秒）\n        this.messageObserver = null // Intersection Observer实例\n        this.visibilityObserver = null // 页面可见性监听\n        this.myUuid = ''\n        this.MessageType = null\n        this.messageElements = new Map() // 消息ID到DOM元素的映射\n        this.readMessages = new Set() // 已读消息ID集合\n    }\n\n    // 初始化ACK管理器\n    init(myUuid, MessageType) {\n        this.myUuid = myUuid\n        this.MessageType = MessageType\n        this.setupIntersectionObserver()\n        this.setupVisibilityObserver()\n    }\n\n    // 设置Intersection Observer监听消息进入可视区域\n    setupIntersectionObserver() {\n        const options = {\n            root: null, // 使用视口作为根\n            rootMargin: '0px',\n            threshold: 0.5 // 当消息50%可见时触发\n        }\n\n        this.messageObserver = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    const messageId = entry.target.dataset.messageId\n                    const fromUuid = entry.target.dataset.fromUuid\n                    \n                    // 只对非自己发送的消息进行ACK确认\n                    if (messageId && fromUuid && fromUuid !== this.myUuid) {\n                        this.markMessageAsRead(messageId)\n                    }\n                }\n            })\n        }, options)\n    }\n\n    // 设置页面可见性监听\n    setupVisibilityObserver() {\n        this.visibilityObserver = () => {\n            if (!document.hidden) {\n                // 页面变为可见时，立即发送所有待确认的ACK\n                this.flushPendingAcks()\n            }\n        }\n        document.addEventListener('visibilitychange', this.visibilityObserver)\n    }\n\n    // 注册消息元素用于监听\n    registerMessageElement(messageId, element, fromUuid) {\n        if (!messageId || !element || fromUuid === this.myUuid) return\n        \n        element.dataset.messageId = messageId\n        element.dataset.fromUuid = fromUuid\n        this.messageElements.set(messageId, element)\n        this.messageObserver.observe(element)\n    }\n\n    // 取消注册消息元素\n    unregisterMessageElement(messageId) {\n        const element = this.messageElements.get(messageId)\n        if (element) {\n            this.messageObserver.unobserve(element)\n            this.messageElements.delete(messageId)\n        }\n    }\n\n    // 标记消息为已读\n    markMessageAsRead(messageId) {\n        if (this.readMessages.has(messageId)) {\n            return // 已经标记为已读\n        }\n        \n        this.readMessages.add(messageId)\n        this.pendingAcks.add(messageId)\n        \n        // 延迟发送ACK，允许批量处理\n        this.scheduleAckSend()\n    }\n\n    // 调度ACK发送\n    scheduleAckSend() {\n        if (this.ackTimer) {\n            clearTimeout(this.ackTimer)\n        }\n        \n        this.ackTimer = setTimeout(() => {\n            this.flushPendingAcks()\n        }, this.ackDelay)\n    }\n\n    // 立即发送所有待确认的ACK\n    flushPendingAcks() {\n        if (this.pendingAcks.size === 0) return\n        \n        const ws = getWebSocket()\n        if (!ws || ws.readyState !== WebSocket.OPEN || !this.MessageType) {\n            return\n        }\n\n        // 将Set转换为数组\n        const ackMessageIds = Array.from(this.pendingAcks)\n        \n        // 构建ACK消息\n        const ackMessage = {\n            avatar: '',\n            fromUsername: '',\n            from: this.myUuid,\n            to: '', // ACK消息的to字段可以为空，服务器会根据ackMessageIds处理\n            content: 'ack',\n            contentType: 10, // ACK消息类型\n            type: 'ack',\n            messageType: 1,\n            url: '',\n            fileSuffix: '',\n            file: new Uint8Array(),\n            messageId: '',\n            isFragmented: false,\n            fragmentIndex: 0,\n            totalFragments: 0,\n            timestamp: Date.now(),\n            checksum: '',\n            ackMessageIds: ackMessageIds,\n            isRead: true,\n            readTimestamp: Date.now()\n        }\n\n        try {\n            const messageBuffer = this.MessageType.encode(this.MessageType.create(ackMessage)).finish()\n            ws.send(messageBuffer)\n            \n            console.log(`发送ACK确认，包含${ackMessageIds.length}条消息:`, ackMessageIds)\n            \n            // 清空待发送ACK列表\n            this.pendingAcks.clear()\n            \n            if (this.ackTimer) {\n                clearTimeout(this.ackTimer)\n                this.ackTimer = null\n            }\n        } catch (error) {\n            console.error('发送ACK消息失败:', error)\n        }\n    }\n\n    // 手动标记聊天窗口的所有消息为已读\n    markChatAsRead(chatId, messages) {\n        if (!messages || messages.length === 0) return\n        \n        messages.forEach(message => {\n            // 只对非自己发送的消息进行ACK确认\n            if (message.from !== this.myUuid && message.messageId) {\n                this.markMessageAsRead(message.messageId)\n            }\n        })\n        \n        // 立即发送ACK\n        this.flushPendingAcks()\n    }\n\n    // 检查消息是否已读\n    isMessageRead(messageId) {\n        return this.readMessages.has(messageId)\n    }\n\n    // 处理接收到的ACK确认消息\n    handleAckMessage(ackMessage) {\n        if (ackMessage.ackMessageIds && ackMessage.ackMessageIds.length > 0) {\n            console.log('收到ACK确认:', ackMessage.ackMessageIds)\n            // 这里可以更新UI显示消息已读状态\n            // 触发自定义事件通知其他组件\n            const event = new CustomEvent('messagesAcked', {\n                detail: {\n                    messageIds: ackMessage.ackMessageIds,\n                    readTimestamp: ackMessage.readTimestamp,\n                    from: ackMessage.from\n                }\n            })\n            window.dispatchEvent(event)\n        }\n    }\n\n    // 销毁ACK管理器\n    destroy() {\n        if (this.messageObserver) {\n            this.messageObserver.disconnect()\n            this.messageObserver = null\n        }\n        \n        if (this.visibilityObserver) {\n            document.removeEventListener('visibilitychange', this.visibilityObserver)\n            this.visibilityObserver = null\n        }\n        \n        if (this.ackTimer) {\n            clearTimeout(this.ackTimer)\n            this.ackTimer = null\n        }\n        \n        this.pendingAcks.clear()\n        this.messageElements.clear()\n        this.readMessages.clear()\n    }\n}\n\n// 创建全局ACK管理器实例\nexport const ackManager = new ACKManager()\n\n// 导出ACK管理器类供其他地方使用\nexport default ACKManager","<template>\r\n    <div class=\"chat-container\">\r\n        <div class=\"chat-header chat-header-center\">\r\n            <span v-if=\"currentChatName\">{{ currentChatName }}</span>\r\n            <span v-else>select</span>\r\n            <div v-if=\"currentChatName\" class=\"header-actions\">\r\n                <button @click=\"startVoiceCall\" class=\"voice-call-btn\" title=\"语音通话\">\r\n                    📞\r\n                </button>\r\n                <button @click=\"startVideoCall\" class=\"video-call-btn\" title=\"视频通话\">\r\n                    📹\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class=\"messages\" ref=\"messagesContainer\">\r\n            <div v-for=\"(msg, idx) in messages\" \r\n                 :key=\"msg.messageId || idx\" \r\n                 :class=\"['message', msg.from === myUuid ? 'self' : 'other']\"\r\n                 :ref=\"el => registerMessageElement(msg, el)\">\r\n                <div class=\"msg-bubble\">\r\n                    <span class=\"sender\">{{ msg.fromUsername }}：</span>\r\n                    <span v-if=\"msg.contentType === 2\" class=\"content\">\r\n                        📎 文件：<a :href=\"msg.url\" download>{{ msg.content }}</a> ({{ formatFileSize(msg.file?.length) }})\r\n                    </span>\r\n                    <span v-else-if=\"msg.contentType === 3\" class=\"content\">\r\n                        🖼️ 图片：<img :src=\"msg.url\" style=\"max-width: 200px; border-radius: 4px; cursor: pointer;\" @click=\"previewImage(msg.url)\">\r\n                    </span>\r\n                    <span v-else-if=\"msg.contentType === 5\" class=\"content\">\r\n                        🎥 视频：<video :src=\"msg.url\" style=\"max-width: 200px; border-radius: 4px; cursor: pointer;\" @click=\"previewVideo(msg.url)\"></video>\r\n                    </span>\r\n                    <span v-if=\"msg.contentType === 4\" class=\"content\">\r\n                        🎤 语音消息：\r\n                        <audio :src=\"msg.url\" controls style=\"vertical-align: middle\"></audio>\r\n                        ({{ formatDuration(msg.duration) }})\r\n                    </span>\r\n                    <span v-else class=\"content\">{{ msg.content }}</span>\r\n\r\n                    <div class=\"message-footer\">\r\n                        <span class=\"timestamp\">{{ formatTime(msg.timestamp) }}</span>\r\n                        <!-- 显示消息已读状态 -->\r\n                        <span v-if=\"msg.from === myUuid && msg.messageId\" class=\"read-status\">\r\n                            <span v-if=\"isMessageRead(msg.messageId)\" class=\"read-indicator\">✓✓</span>\r\n                            <span v-else class=\"unread-indicator\">✓</span>\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- 打字指示器 -->\r\n            <div v-if=\"showTypingIndicator\" class=\"message other\">\r\n                <div class=\"typing-indicator\">\r\n                    <span class=\"sender\">{{ typingUser }}正在输入</span>\r\n                    <div class=\"typing-dots\">\r\n                        <div class=\"typing-dot\"></div>\r\n                        <div class=\"typing-dot\"></div>\r\n                        <div class=\"typing-dot\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"input-area-wrap\">\r\n            <div class=\"input-actions input-actions-top\">\r\n                <button class=\"input-action-btn\" @click=\"toggleEmojiPanel\" title=\"发送表情\">😊</button>\r\n\r\n                <input type=\"file\" ref=\"fileInput\" style=\"display: none\" @change=\"handleFileSelect\">\r\n                <button class=\"input-action-btn\" @click=\"$refs.fileInput.click()\" title=\"发送文件\">📄</button>\r\n\r\n                <button class=\"input-action-btn\" @click=\"toggleRecording\" :class=\"{ recording: isRecording }\"\r\n                    title=\"语音消息\">\r\n                    {{ isRecording ? '⏹' : '🎤' }}\r\n                </button>\r\n\r\n                <button class=\"input-action-btn\" @click=\"showNotImpl('视频')\" title=\"发送视频\">🎥</button>\r\n            </div>\r\n            <div v-if=\"showEmojiPanel\" class=\"emoji-panel\" ref=\"emojiPanelRef\">\r\n                <span v-for=\"emoji in emojiList\" :key=\"emoji\" class=\"emoji-item\" @click=\"insertEmoji(emoji)\">{{ emoji\r\n                    }}</span>\r\n            </div>\r\n            <div class=\"input-area\">\r\n                <textarea v-model=\"input\" @keyup.enter=\"sendMessage\" @input=\"handleInputChange\" placeholder=\"输入消息...\" rows=\"1\"\r\n                    class=\"msg-textarea\" />\r\n                <button @click=\"sendMessage\">发送</button>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"!wsConnected\" class=\"ws-status\">WebSocket 未连接</div>\r\n        \r\n        <!-- 图片预览模态框 -->\r\n        <div v-if=\"showImagePreview\" class=\"image-preview-modal\" @click=\"closeImagePreview\">\r\n            <div class=\"image-preview-container\">\r\n                <img :src=\"previewImageUrl\" class=\"preview-image\" @click.stop>\r\n                <button class=\"close-preview-btn\" @click=\"closeImagePreview\">×</button>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- 视频预览模态框 -->\r\n        <div v-if=\"showVideoPreview\" class=\"video-preview-modal\" @click=\"closeVideoPreview\">\r\n            <div class=\"video-preview-container\">\r\n                <video :src=\"previewVideoUrl\" class=\"preview-video\" controls @click.stop></video>\r\n                <button class=\"close-preview-btn\" @click=\"closeVideoPreview\">×</button>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- WebRTC语音通话组件 -->\r\n        <WebRTCVoiceCall\r\n            v-if=\"MessageType\"\r\n            ref=\"voiceCallRef\"\r\n            :my-uuid=\"myUuid\"\r\n            :my-name=\"myName\"\r\n            :message-type=\"MessageType\"\r\n            @call-started=\"onVoiceCallStarted\"\r\n            @call-ended=\"onVoiceCallEnded\"\r\n        />\r\n        \r\n        <!-- WebRTC视频通话组件 -->\r\n        <WebRTCVideoCall\r\n            v-if=\"MessageType\"\r\n            ref=\"videoCallRef\"\r\n            :my-uuid=\"myUuid\"\r\n            :my-name=\"myName\"\r\n            :message-type=\"MessageType\"\r\n            @call-started=\"onVideoCallStarted\"\r\n            @call-ended=\"onVideoCallEnded\"\r\n        />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, onBeforeUnmount, nextTick, watch } from 'vue'\r\nimport protobuf from 'protobufjs'\r\nimport { useRoute } from 'vue-router'\r\nimport { formatFileSize } from '@/utils/format'\r\nimport { emojiList } from '@/components/chat2/emoji'\r\nimport { initWebSocket, closeWebSocket, getWebSocket } from '@/components/chat2/websocket'\r\nimport { toUuid, currentChatTargetName, currentChatID, showFriendRequest, friendRequestInfo, showFriendReplyRequest, friendResponseInfo, chatMessages, friends, groups, currentChatType } from './state.js'\r\n\r\nimport WebRTCVoiceCall from './WebRTCVoiceCall.vue'\r\nimport WebRTCVideoCall from './WebRTCVideoCall.vue'\r\nimport { ackManager } from './ackManager.js'\r\n\r\nconst route = useRoute()\r\nconst sessionKey = route.query.session || 'default'\r\nconst messages = computed(() => chatMessages.value[toUuid.value] || [])\r\nconst input = ref('')\r\nconst userinfo = JSON.parse(localStorage.getItem(`userinfo_${sessionKey}`) || '{}')\r\nconst myName = userinfo.nickname || '我'\r\nconst myUuid = userinfo.uuid\r\nconst MessageType = ref(null)\r\nlet ws = null\r\nconst wsConnected = ref(false)\r\n// 好友请求相关变量已移动到 state.js 中\r\nconst currentChatName = computed(() => {\r\n    return currentChatTargetName.value\r\n})\r\n// 文件传输\r\nconst fileInput = ref(null)\r\n// const currentChatID = ref(0)\r\n// 录制语音消息\r\nconst isRecording = ref(false)\r\nconst mediaRecorder = ref(null)\r\nconst audioChunks = ref([])\r\nconst audioBlob = ref(null)\r\nconst showEmojiPanel = ref(false)\r\nconst emojiPanelRef = ref(null)\r\n// 图片和视频预览\r\nconst showImagePreview = ref(false)\r\nconst showVideoPreview = ref(false)\r\nconst previewImageUrl = ref('')\r\nconst previewVideoUrl = ref('')\r\n// WebRTC语音通话\r\nconst voiceCallRef = ref(null)\r\n// WebRTC视频通话\r\nconst videoCallRef = ref(null)\r\n// ACK相关\r\nconst messagesContainer = ref(null)\r\nconst readMessageIds = ref(new Set()) // 已读消息ID集合\r\n\r\n// 打字指示器相关\r\nconst showTypingIndicator = ref(false)\r\nconst typingUser = ref('')\r\nconst typingTimer = ref(null)\r\nasync function handleFileSelect(event) {\r\n    const file = event.target.files[0]\r\n    if (!file) return\r\n    const reader = new FileReader()\r\n    reader.onload = async (e) => {\r\n        const fileBuffer = new Uint8Array(e.target.result)\r\n        const fileName = file.name\r\n        const suffix = file.name.split('.').pop()\r\n        sendFileMessage({\r\n            fileName,\r\n            fileBuffer,\r\n            suffix\r\n        })\r\n    }\r\n    reader.readAsArrayBuffer(file)\r\n}\r\nfunction sendFileMessage(fileData) {\r\n    if (!MessageType.value || !wsConnected.value) return\r\n    \r\n    let contentType = 2; // 默认为文件类型\r\n    let type = 'file';\r\n    \r\n    // 根据文件后缀判断类型\r\n    const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'];\r\n    const videoExtensions = ['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv'];\r\n    if (imageExtensions.includes(fileData.suffix.toLowerCase())) {\r\n        contentType = 3;\r\n        type = 'image';\r\n    } else if (videoExtensions.includes(fileData.suffix.toLowerCase())) {\r\n        contentType = 5;\r\n        type = 'video';\r\n    }\r\n    \r\n    const msgObj = {\r\n        avatar: '',\r\n        fromUsername: myName,\r\n        from: myUuid,\r\n        to: toUuid.value,\r\n        content: fileData.fileName,\r\n        contentType: contentType,\r\n        type: type,\r\n        messageType: currentChatType.value,\r\n\r\n        url: URL.createObjectURL(new Blob([fileData.fileBuffer])),\r\n        fileSuffix : fileData.suffix,\r\n        file: fileData.fileBuffer,\r\n        messageId: generateMessageId(), // 生成唯一消息ID\r\n        isFragmented: false,\r\n        fragmentIndex: 0,\r\n        totalFragments: 0,\r\n        timestamp: Date.now(),\r\n        checksum: '',\r\n        ackMessageIds: [],\r\n        isRead: false,\r\n        readTimestamp: 0\r\n    }\r\n    const messageBuffer = MessageType.value.encode(MessageType.value.create(msgObj)).finish()\r\n    ws.send(messageBuffer)\r\n    if (!chatMessages.value[toUuid.value]) chatMessages.value[toUuid.value] = []\r\n    chatMessages.value[toUuid.value].push({\r\n        ...msgObj,\r\n        timestamp: Date.now()\r\n    })\r\n}\r\nasync function toggleRecording() {\r\n    if (!isRecording.value) {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\r\n            audioChunks.value = []\r\n            mediaRecorder.value = new MediaRecorder(stream)\r\n\r\n            mediaRecorder.value.ondataavailable = e => {\r\n                audioChunks.value.push(e.data)\r\n            }\r\n\r\n            mediaRecorder.value.onstop = async () => {\r\n                audioBlob.value = new Blob(audioChunks.value, { type: 'audio/webm' })\r\n                const arrayBuffer = await audioBlob.value.arrayBuffer()\r\n                sendVoiceMessage({\r\n                    audioBuffer: new Uint8Array(arrayBuffer),\r\n                    duration: Math.round(audioBlob.value.duration)\r\n                })\r\n                stream.getTracks().forEach(track => track.stop())\r\n            }\r\n\r\n            mediaRecorder.value.start()\r\n            isRecording.value = true\r\n        } catch (e) {\r\n            alert('麦克风访问被拒绝')\r\n        }\r\n    } else {\r\n        mediaRecorder.value.stop()\r\n        isRecording.value = false\r\n    }\r\n}\r\nfunction sendVoiceMessage(voiceData) {\r\n    if (!MessageType.value || !wsConnected.value) return\r\n    const msgObj = {\r\n        ...voiceData,\r\n        avatar: '',\r\n        fromUsername: myName,\r\n        from: myUuid,\r\n        to: toUuid.value,\r\n        content: '语音消息',\r\n        contentType: 4,\r\n        type: 'audio',\r\n        messageType: currentChatType.value,\r\n        url: URL.createObjectURL(audioBlob.value),\r\n        file: voiceData.audioBuffer,\r\n        messageId: generateMessageId(), // 生成唯一消息ID\r\n        isFragmented: false,\r\n        fragmentIndex: 0,\r\n        totalFragments: 0,\r\n        timestamp: Date.now(),\r\n        checksum: '',\r\n        ackMessageIds: [],\r\n        isRead: false,\r\n        readTimestamp: 0\r\n    }\r\n\r\n    const messageBuffer = MessageType.value.encode(MessageType.value.create(msgObj)).finish()\r\n    ws.send(messageBuffer)\r\n\r\n    if (!chatMessages.value[toUuid.value]) chatMessages.value[toUuid.value] = []\r\n    chatMessages.value[toUuid.value].push({\r\n        ...msgObj,\r\n        timestamp: Date.now()\r\n    })\r\n}\r\n// 添加时长格式化工具\r\nfunction formatDuration(seconds) {\r\n    if (!seconds) return '0:00'\r\n    const mins = Math.floor(seconds / 60)\r\n    const secs = String(seconds % 60).padStart(2, '0')\r\n    return `${mins}:${secs}`\r\n}\r\n// 保存未读消息计数到localStorage\r\nfunction saveUnreadCounts() {\r\n    const unreadCounts = {}\r\n    // 保存好友的未读消息计数\r\n    friends.value.forEach(friend => {\r\n        if (friend.unread > 0) {\r\n            unreadCounts[friend.uuid] = friend.unread\r\n        }\r\n    })\r\n    // 保存群组的未读消息计数\r\n    groups.value.forEach(group => {\r\n        if (group.unread > 0) {\r\n            unreadCounts[group.uuid] = group.unread\r\n        }\r\n    })\r\n    localStorage.setItem(`unreadCounts_${sessionKey}`, JSON.stringify(unreadCounts))\r\n}\r\n// WebSocket 长轮询\r\nonMounted(async () => {\r\n    // 加载 proto\r\n    const root = await protobuf.load('/message.proto')\r\n    MessageType.value = root.lookup('protocol.Message')\r\n    initWebSocket(sessionKey, handleWebSocketMessage, myUuid, MessageType.value)\r\n\r\n    ws = getWebSocket()\r\n    if (ws) {\r\n        wsConnected.value = ws.readyState === WebSocket.OPEN\r\n        ws.addEventListener('open', () => (wsConnected.value = true))\r\n        ws.addEventListener('close', () => (wsConnected.value = false))\r\n    }\r\n    \r\n    // 初始化ACK管理器\r\n    ackManager.init(myUuid, MessageType.value)\r\n    \r\n    // 监听消息已读确认事件\r\n    window.addEventListener('messagesAcked', handleMessagesAcked)\r\n})\r\n// 添加分片管理器\r\nconst fragmentManager = new Map(); // 存储待重组的分片\r\n// 处理 WebSocket 消息\r\nfunction handleWebSocketMessage(event) {\r\n    if (!MessageType.value) return;\r\n    \r\n    const buffer = new Uint8Array(event.data);\r\n    const decodedBuffer = MessageType.value.decode(buffer);\r\n    var decoded = decodedBuffer;\r\n    if (decodedBuffer.isFragmented) {\r\n        // 处理分片消息\r\n        const completeMessage = handleFragmentedMessage(decodedBuffer);\r\n        if (!completeMessage) {\r\n            console.log(\"分片消息未完成\")\r\n            // 消息还未完整，等待更多分片\r\n            return;\r\n        }\r\n        // 使用重组后的完整消息\r\n        decoded = completeMessage;\r\n    }\r\n    \r\n    const { from, to, file } = decoded;\r\n    const isPrivateMessage = to === myUuid;\r\n    const chatId = isPrivateMessage ? from : to;\r\n    try {\r\n        switch (decoded.contentType) {\r\n            case 1: // 文本消息\r\n                handleTextMessage(decoded, chatId, isPrivateMessage);\r\n                break;\r\n            case 2: // 文件消息\r\n                handleFileMessage(decoded, chatId, isPrivateMessage);\r\n                break;\r\n            case 3: // 图片消息\r\n                handleImageMessage(decoded, chatId, isPrivateMessage);\r\n                break;\r\n            case 4: // 音频消息\r\n                handleAudioMessage(decoded, chatId, isPrivateMessage);\r\n                break;\r\n            case 5: // 视频消息\r\n                handleVideoMessage(decoded, chatId, isPrivateMessage);\r\n                break;\r\n            case 6: // WebRTC信令消息\r\n                handleWebRTCSignaling(decoded);\r\n                break;\r\n            case 7: // WebRTC视频信令消息\r\n                handleWebRTCVideoSignaling(decoded);\r\n                break;\r\n            case 8: // 好友请求\r\n                handleFriendRequest(decoded);\r\n                break;\r\n            case 9: // 好友回复\r\n                handleFriendResponse(decoded);\r\n                break;\r\n            case 10: // ACK确认消息\r\n                handleAckMessage(decoded);\r\n                break;\r\n            default:\r\n                console.log(\"未知消息类型\")\r\n                break;\r\n        }\r\n        \r\n        saveUnreadCounts();\r\n    } catch (e) {\r\n         console.log(\"未知消息类型\")\r\n    }\r\n}\r\n\r\n// 分片消息处理函数\r\nfunction handleFragmentedMessage(fragment) {\r\n    const messageId = fragment.messageId;\r\n    \r\n    if (!fragmentManager.has(messageId)) {\r\n        fragmentManager.set(messageId, {\r\n            fragments: new Array(fragment.totalFragments),\r\n            receivedCount: 0,\r\n            timestamp: Date.now()\r\n        });\r\n    }\r\n    const messageInfo = fragmentManager.get(messageId);\r\n    // 检查是否已经收到过这个分片\r\n    if (messageInfo.fragments[fragment.fragmentIndex]) {\r\n        console.warn(`重复收到分片 ${fragment.fragmentIndex}`);\r\n        return null;\r\n    }\r\n    // 存储分片\r\n    messageInfo.fragments[fragment.fragmentIndex] = fragment;\r\n    messageInfo.receivedCount++;\r\n    console.log(`收到分片 ${fragment.fragmentIndex + 1}/${fragment.totalFragments}`);\r\n    // 检查是否收到所有分片\r\n    if (messageInfo.receivedCount === fragment.totalFragments) {\r\n        const completeMessage = reassembleMessage(messageInfo.fragments);\r\n        fragmentManager.delete(messageId);\r\n        console.log('消息重组完成:', messageId);\r\n        return completeMessage;\r\n    }\r\n    \r\n    return null;\r\n}\r\n\r\n// 消息重组函数\r\nfunction reassembleMessage(fragments) {\r\n    // 按索引排序确保正确顺序\r\n    fragments.sort((a, b) => a.fragmentIndex - b.fragmentIndex);\r\n    // 拼接所有分片的file字段（这是序列化的protobuf数据）\r\n    let totalSize = 0;\r\n    fragments.forEach(fragment => {\r\n        if (fragment.file) {\r\n            totalSize += fragment.file.length;\r\n        }\r\n    });\r\n    const serializedData = new Uint8Array(totalSize);\r\n    let offset = 0;\r\n    fragments.forEach(fragment => {\r\n        if (fragment.file) {\r\n            serializedData.set(fragment.file, offset);\r\n            offset += fragment.file.length;\r\n        }\r\n    });\r\n    \r\n    // 关键步骤：反序列化protobuf数据恢复原始消息\r\n    try {\r\n        const originalMessage = MessageType.value.decode(serializedData);\r\n        originalMessage.isFragmented = false;\r\n        console.log(originalMessage)\r\n        return originalMessage;\r\n    } catch (error) {\r\n        console.error('反序列化失败:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// 重构后的消息处理函数\r\nfunction handleTextMessage(decoded, chatId, isPrivateMessage) {\r\n    updateUnreadCount(chatId, isPrivateMessage);\r\n    addMessageToChat(chatId, decoded);\r\n}\r\n\r\nfunction handleFileMessage(decoded, chatId, isPrivateMessage) {\r\n    console.log(\"type: \",decoded.fileSuffix)\r\n    // 创建文件URL\r\n    decoded.url = URL.createObjectURL(\r\n        new Blob([decoded.file], { type: getMimeType(decoded.fileSuffix) })\r\n    );\r\n    console.log(decoded)\r\n    updateUnreadCount(chatId, isPrivateMessage);\r\n    addMessageToChat(chatId, decoded);\r\n}\r\n\r\nfunction handleImageMessage(decoded, chatId, isPrivateMessage) {\r\n    console.log(\"图片消息: \", decoded.fileSuffix)\r\n    // 创建图片URL\r\n    decoded.url = URL.createObjectURL(\r\n        new Blob([decoded.file], { type: getMimeType(decoded.fileSuffix) })\r\n    );\r\n    updateUnreadCount(chatId, isPrivateMessage);\r\n    addMessageToChat(chatId, decoded);\r\n}\r\n\r\nfunction handleVideoMessage(decoded, chatId, isPrivateMessage) {\r\n    decoded.url = URL.createObjectURL(\r\n        new Blob([decoded.file], { type: getMimeType(decoded.fileSuffix) })\r\n    );\r\n    updateUnreadCount(chatId, isPrivateMessage);\r\n    addMessageToChat(chatId, decoded);\r\n}\r\n\r\nfunction handleAudioMessage(decoded, chatId, isPrivateMessage) {\r\n    decoded.url = URL.createObjectURL(\r\n        new Blob([decoded.file], { getType: getMimeType(decoded.fileSuffix) })\r\n    );\r\n    updateUnreadCount(chatId, isPrivateMessage);\r\n    addMessageToChat(chatId, decoded);\r\n}\r\n\r\n// 处理加好友请求\r\nfunction handleFriendRequest(decoded) {\r\n    friendRequestInfo.value = {\r\n        fromUsername: decoded.fromUsername,\r\n        content: decoded.content,\r\n        from: decoded.from\r\n    };\r\n    showFriendRequest.value = true;\r\n}\r\n//处理回复加好友请求\r\nfunction handleFriendResponse(decoded) {\r\n    friendResponseInfo.value = {\r\n        fromUsername: decoded.fromUsername,\r\n        content: decoded.content,\r\n        from: decoded.from\r\n    };\r\n    showFriendReplyRequest.value = true;\r\n}\r\n\r\n// WebRTC信令消息处理\r\nfunction handleWebRTCSignaling(decoded) {\r\n    if (voiceCallRef.value) {\r\n        voiceCallRef.value.handleSignalingMessage(decoded);\r\n    }\r\n}\r\n\r\n// WebRTC视频信令消息处理\r\nfunction handleWebRTCVideoSignaling(decoded) {\r\n    if (videoCallRef.value) {\r\n        videoCallRef.value.handleSignalingMessage(decoded);\r\n    }\r\n}\r\n\r\n// 发起语音通话\r\nfunction startVoiceCall() {\r\n    if (!toUuid.value || !currentChatName.value) {\r\n        alert('请先选择聊天对象');\r\n        return;\r\n    }\r\n    \r\n    if (voiceCallRef.value) {\r\n        voiceCallRef.value.startCall(toUuid.value, currentChatName.value);\r\n    }\r\n}\r\n\r\n// 发起视频通话\r\nfunction startVideoCall() {\r\n    if (!toUuid.value || !currentChatName.value) {\r\n        alert('请先选择聊天对象');\r\n        return;\r\n    }\r\n    \r\n    if (videoCallRef.value) {\r\n        videoCallRef.value.startCall(toUuid.value, currentChatName.value);\r\n    }\r\n}\r\n\r\n// 语音通话开始事件\r\nfunction onVoiceCallStarted() {\r\n    console.log('语音通话已开始');\r\n}\r\n\r\n// 语音通话结束事件\r\nfunction onVoiceCallEnded() {\r\n    console.log('语音通话已结束');\r\n}\r\n\r\n// 视频通话开始事件\r\nfunction onVideoCallStarted() {\r\n    console.log('视频通话已开始');\r\n}\r\n\r\n// 视频通话结束事件\r\nfunction onVideoCallEnded() {\r\n    console.log('视频通话已结束');\r\n}\r\n\r\n// 辅助函数\r\nfunction updateUnreadCount(chatId, isPrivateMessage) {\r\n    if (currentChatID.value !== chatId) {\r\n        const targetCollection = isPrivateMessage ? friends.value : groups.value;\r\n        const targetUpdate = targetCollection.find(item => item.uuid === chatId);\r\n        if (targetUpdate) {\r\n            console.log(\"更新未读消息数量\")\r\n            targetUpdate.unread++;\r\n        }\r\n    }\r\n}\r\n\r\nfunction addMessageToChat(chatId, decoded) {\r\n    chatMessages.value[chatId] ??= [];\r\n    console.log(\"audio: \", decoded)\r\n    \r\n    // 为消息生成唯一ID（如果没有的话）\r\n    if (!decoded.messageId) {\r\n        decoded.messageId = generateMessageId()\r\n    }\r\n    \r\n    chatMessages.value[chatId].push({\r\n        ...decoded,\r\n        timestamp: decoded.timestamp || Date.now()\r\n    });\r\n}\r\n\r\nfunction getMimeType(fileSuffix) {\r\n    const mimeTypes = {\r\n        'jpg': 'image/jpeg',\r\n        'jpeg': 'image/jpeg',\r\n        'png': 'image/png',\r\n        'gif': 'image/gif',\r\n        'webp': 'image/webp',\r\n        'mp4': 'video/mp4',\r\n        'avi': 'video/x-msvideo',\r\n        'mov': 'video/quicktime',\r\n        'wmv': 'video/x-ms-wmv',\r\n        'flv': 'video/x-flv',\r\n        'mkv': 'video/x-matroska',\r\n        'pdf': 'application/pdf',\r\n        'txt': 'text/plain',\r\n        'doc': 'application/msword',\r\n        'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n        'xls': 'application/vnd.ms-excel',\r\n        'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n        'ppt': 'application/vnd.ms-powerpoint',\r\n        'pptx': 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\r\n        'zip': 'application/zip',\r\n        'rar': 'application/x-rar-compressed',\r\n        '7z': 'application/x-7z-compressed',\r\n        'mp3': 'audio/mpeg',\r\n        'wav': 'audio/wav',\r\n        'aac': 'audio/aac',\r\n        'flac': 'audio/flac',\r\n        'ogg': 'audio/ogg',\r\n        'm4a': 'audio/m4a',\r\n    };\r\n    return mimeTypes[fileSuffix?.toLowerCase()] || 'application/octet-stream';\r\n}\r\n\r\n// 定期清理过期的分片（可选）\r\nsetInterval(() => {\r\n    const now = Date.now();\r\n    const timeout = 30000; // 30秒超时\r\n    \r\n    for (const [messageId, messageInfo] of fragmentManager.entries()) {\r\n        if (now - messageInfo.timestamp > timeout) {\r\n            console.warn(`清理过期分片: ${messageId}`);\r\n            fragmentManager.delete(messageId);\r\n        }\r\n    }\r\n}, 10000); // 每10秒检查一次\r\n\r\nonBeforeUnmount(() => {\r\n    closeWebSocket()\r\n    // 清理ACK管理器\r\n    ackManager.destroy()\r\n    // 移除事件监听\r\n    window.removeEventListener('messagesAcked', handleMessagesAcked)\r\n})\r\nfunction formatTime(ts) {\r\n    const date = new Date(ts)\r\n    return date.toLocaleTimeString()\r\n}\r\n// 发送消息\r\n// 处理输入变化，显示打字指示器\r\nfunction handleInputChange() {\r\n    if (!input.value.trim()) {\r\n        hideTypingIndicator()\r\n        return\r\n    }\r\n    \r\n    // 模拟显示打字指示器（在实际应用中，这里应该通过WebSocket发送打字状态给其他用户）\r\n    showTypingIndicatorDemo()\r\n}\r\n\r\n// 显示打字指示器演示\r\nfunction showTypingIndicatorDemo() {\r\n    // 清除之前的定时器\r\n    if (typingTimer.value) {\r\n        clearTimeout(typingTimer.value)\r\n    }\r\n    \r\n    // 显示打字指示器\r\n    showTypingIndicator.value = true\r\n    typingUser.value = '对方'\r\n    \r\n    // 3秒后自动隐藏\r\n    typingTimer.value = setTimeout(() => {\r\n        hideTypingIndicator()\r\n    }, 3000)\r\n}\r\n\r\n// 隐藏打字指示器\r\nfunction hideTypingIndicator() {\r\n    showTypingIndicator.value = false\r\n    typingUser.value = ''\r\n    if (typingTimer.value) {\r\n        clearTimeout(typingTimer.value)\r\n        typingTimer.value = null\r\n    }\r\n}\r\n\r\nfunction sendMessage() {\r\n    // 发送消息时隐藏打字指示器\r\n    hideTypingIndicator()\r\n    if (!input.value.trim() || !MessageType.value || !wsConnected.value) return\r\n    if (!toUuid.value.trim()) {\r\n        alert('请先选择聊天对象')\r\n        return\r\n    }\r\n    // 消息体\r\n    const msgObj = {\r\n        avatar: '',\r\n        fromUsername: myName,\r\n        from: myUuid,\r\n        to: toUuid.value,\r\n        content: input.value,\r\n        contentType: 1, // 文字\r\n        type: '',\r\n        messageType: currentChatType.value, // 单聊或群聊\r\n        url: '',\r\n        fileSuffix: '',\r\n        file: new Uint8Array(),\r\n        messageId: generateMessageId(), // 生成唯一消息ID\r\n        isFragmented: false,\r\n        fragmentIndex: 0,\r\n        totalFragments: 0,\r\n        timestamp: Date.now(),\r\n        checksum: '',\r\n        ackMessageIds: [],\r\n        isRead: false,\r\n        readTimestamp: 0\r\n    }\r\n    const errMsg = MessageType.value.verify(msgObj)\r\n    if (errMsg) {\r\n        alert('消息格式错误: ' + errMsg)\r\n        return\r\n    }\r\n    const messageBuffer = MessageType.value.encode(MessageType.value.create(msgObj)).finish()\r\n    ws.send(messageBuffer)\r\n    // 本地也显示消息\r\n    if (!chatMessages.value[toUuid.value]) chatMessages.value[toUuid.value] = []\r\n    chatMessages.value[toUuid.value].push({ ...msgObj, timestamp: Date.now() })\r\n    input.value = ''\r\n}\r\nfunction showNotImpl(type) {\r\n    alert(type + '功能暂未实现')\r\n}\r\nfunction toggleEmojiPanel() {\r\n    showEmojiPanel.value = !showEmojiPanel.value\r\n    if (showEmojiPanel.value) {\r\n        nextTick(() => {\r\n            document.addEventListener('mousedown', handleClickOutside)\r\n        })\r\n    } else {\r\n        document.removeEventListener('mousedown', handleClickOutside)\r\n    }\r\n}\r\nfunction handleClickOutside(e) {\r\n    if (emojiPanelRef.value && !emojiPanelRef.value.contains(e.target)) {\r\n        showEmojiPanel.value = false\r\n        document.removeEventListener('mousedown', handleClickOutside)\r\n    }\r\n}\r\nfunction insertEmoji(emoji) {\r\n    input.value += emoji\r\n    showEmojiPanel.value = false\r\n    document.removeEventListener('mousedown', handleClickOutside)\r\n}\r\nonBeforeUnmount(() => {\r\n    document.removeEventListener('mousedown', handleClickOutside)\r\n})\r\n\r\n// 图片预览函数\r\nfunction previewImage(url) {\r\n    previewImageUrl.value = url\r\n    showImagePreview.value = true\r\n}\r\n\r\nfunction closeImagePreview() {\r\n    showImagePreview.value = false\r\n    previewImageUrl.value = ''\r\n}\r\n\r\n// 视频预览函数\r\nfunction previewVideo(url) {\r\n    previewVideoUrl.value = url\r\n    showVideoPreview.value = true\r\n}\r\n\r\nfunction closeVideoPreview() {\r\n    showVideoPreview.value = false\r\n    previewVideoUrl.value = ''\r\n}\r\n\r\n// ACK相关方法\r\n// 生成消息唯一ID\r\nfunction generateMessageId() {\r\n    return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n}\r\n\r\n// 注册消息元素到ACK管理器\r\nfunction registerMessageElement(msg, el) {\r\n    if (el && msg.messageId && msg.from !== myUuid) {\r\n        nextTick(() => {\r\n            ackManager.registerMessageElement(msg.messageId, el, msg.from)\r\n        })\r\n    }\r\n}\r\n\r\n// 检查消息是否已读\r\nfunction isMessageRead(messageId) {\r\n    return readMessageIds.value.has(messageId)\r\n}\r\n\r\n// 处理ACK确认消息\r\nfunction handleAckMessage(decoded) {\r\n    ackManager.handleAckMessage(decoded)\r\n}\r\n\r\n// 处理消息已读确认事件\r\nfunction handleMessagesAcked(event) {\r\n    const { messageIds } = event.detail\r\n    messageIds.forEach(messageId => {\r\n        readMessageIds.value.add(messageId)\r\n    })\r\n}\r\n\r\n// 监听聊天对象变化，标记当前聊天为已读\r\nwatch(toUuid, (newUuid, oldUuid) => {\r\n    if (newUuid && newUuid !== oldUuid) {\r\n        // 切换聊天时，标记当前聊天的所有消息为已读\r\n        nextTick(() => {\r\n            const currentMessages = messages.value\r\n            if (currentMessages.length > 0) {\r\n                ackManager.markChatAsRead(newUuid, currentMessages)\r\n            }\r\n        })\r\n    }\r\n})\r\n\r\n// 监听页面可见性变化\r\nwatch(() => document.hidden, (hidden) => {\r\n    if (!hidden && toUuid.value) {\r\n        // 页面变为可见时，标记当前聊天为已读\r\n        nextTick(() => {\r\n            const currentMessages = messages.value\r\n            if (currentMessages.length > 0) {\r\n                ackManager.markChatAsRead(toUuid.value, currentMessages)\r\n            }\r\n        })\r\n    }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.create-group-btn:hover {\r\n    background: #369870;\r\n}\r\n.add-friend-btn {\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 4px;\r\n    padding: 4px 12px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    margin-left: 8px;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.chat-container {\r\n    flex: 1;\r\n    margin: 0;\r\n    border: 1px solid #ddd;\r\n    border-radius: 0;\r\n    background: #fafafa;\r\n    display: flex;\r\n    flex-direction: column;\r\n    height: 100vh;\r\n    min-width: 0;\r\n}\r\n\r\n.chat-header {\r\n    height: 48px;\r\n    line-height: 48px;\r\n    font-size: 18px;\r\n    font-weight: bold;\r\n    color: #333;\r\n    padding: 0 24px;\r\n    border-bottom: 1px solid #eee;\r\n    background: #f7f7f7;\r\n}\r\n\r\n.chat-header-center {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    text-align: center;\r\n    font-size: 20px;\r\n    font-weight: bold;\r\n    letter-spacing: 2px;\r\n    position: relative;\r\n}\r\n\r\n.chat-header-center > span {\r\n    flex: 1;\r\n    text-align: center;\r\n}\r\n\r\n.header-actions {\r\n    display: flex;\r\n    gap: 8px;\r\n    align-items: center;\r\n}\r\n\r\n.voice-call-btn {\r\n    background: #42b983;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 50%;\r\n    width: 36px;\r\n    height: 36px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    transition: all 0.3s;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n\r\n.voice-call-btn:hover {\r\n    background: #369870;\r\n    transform: scale(1.1);\r\n}\r\n\r\n.voice-call-btn:active {\r\n    transform: scale(0.95);\r\n}\r\n\r\n.video-call-btn {\r\n    background: #4285f4;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 50%;\r\n    width: 36px;\r\n    height: 36px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    transition: all 0.3s;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin-left: 8px;\r\n}\r\n\r\n.video-call-btn:hover {\r\n    background: #3367d6;\r\n    transform: scale(1.1);\r\n}\r\n\r\n.video-call-btn:active {\r\n    transform: scale(0.95);\r\n}\r\n\r\n.messages {\r\n    flex: 1;\r\n    overflow-y: auto;\r\n    padding: 16px;\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.message {\r\n    display: flex;\r\n    margin-bottom: 12px;\r\n}\r\n\r\n.message.self {\r\n    justify-content: flex-end;\r\n}\r\n\r\n.message.other {\r\n    justify-content: flex-start;\r\n}\r\n\r\n.msg-bubble {\r\n    padding: 8px 12px;\r\n    border-radius: 16px;\r\n    max-width: 80%;\r\n    word-break: break-all;\r\n    display: inline-block;\r\n    position: relative;\r\n    animation: bubbleAppear 0.3s ease-out;\r\n    transition: all 0.2s ease;\r\n}\r\n\r\n.msg-bubble:hover {\r\n    transform: scale(1.02);\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n@keyframes bubbleAppear {\r\n    0% {\r\n        opacity: 0;\r\n        transform: scale(0.8) translateY(10px);\r\n    }\r\n    100% {\r\n        opacity: 1;\r\n        transform: scale(1) translateY(0);\r\n    }\r\n}\r\n\r\n@keyframes bubbleAppearRight {\r\n    0% {\r\n        opacity: 0;\r\n        transform: scale(0.8) translateX(20px) translateY(10px);\r\n    }\r\n    100% {\r\n        opacity: 1;\r\n        transform: scale(1) translateX(0) translateY(0);\r\n    }\r\n}\r\n\r\n@keyframes bubbleAppearLeft {\r\n    0% {\r\n        opacity: 0;\r\n        transform: scale(0.8) translateX(-20px) translateY(10px);\r\n    }\r\n    100% {\r\n        opacity: 1;\r\n        transform: scale(1) translateX(0) translateY(0);\r\n    }\r\n}\r\n\r\n/* 打字动画效果 */\r\n@keyframes typing {\r\n    0%, 60%, 100% {\r\n        transform: translateY(0);\r\n    }\r\n    30% {\r\n        transform: translateY(-10px);\r\n    }\r\n}\r\n\r\n.typing-indicator {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 8px 12px;\r\n    background: #e6e6e6;\r\n    border-radius: 16px;\r\n    border-bottom-left-radius: 4px;\r\n    margin-bottom: 12px;\r\n    animation: bubbleAppearLeft 0.3s ease-out;\r\n}\r\n\r\n.typing-dots {\r\n    display: flex;\r\n    gap: 3px;\r\n}\r\n\r\n.typing-dot {\r\n    width: 6px;\r\n    height: 6px;\r\n    background: #888;\r\n    border-radius: 50%;\r\n    animation: typing 1.4s infinite;\r\n}\r\n\r\n.typing-dot:nth-child(2) {\r\n    animation-delay: 0.2s;\r\n}\r\n\r\n.typing-dot:nth-child(3) {\r\n    animation-delay: 0.4s;\r\n}\r\n\r\n.message.self .msg-bubble {\r\n    background: #d1f5d3;\r\n    color: #222;\r\n    border-bottom-right-radius: 4px;\r\n    border-bottom-left-radius: 16px;\r\n    align-items: flex-end;\r\n    animation: bubbleAppearRight 0.3s ease-out;\r\n}\r\n\r\n.message.other .msg-bubble {\r\n    background: #e6e6e6;\r\n    color: #222;\r\n    border-bottom-left-radius: 4px;\r\n    border-bottom-right-radius: 16px;\r\n    align-items: flex-start;\r\n    animation: bubbleAppearLeft 0.3s ease-out;\r\n}\r\n\r\n.sender {\r\n    font-weight: bold;\r\n    margin-right: 6px;\r\n}\r\n\r\n.message-footer {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    margin-top: 4px;\r\n}\r\n\r\n.timestamp {\r\n    color: #888;\r\n    font-size: 12px;\r\n}\r\n\r\n.read-status {\r\n    margin-left: 8px;\r\n    font-size: 12px;\r\n}\r\n\r\n.read-indicator {\r\n    color: #42b983;\r\n    font-weight: bold;\r\n}\r\n\r\n.unread-indicator {\r\n    color: #888;\r\n    font-weight: bold;\r\n}\r\n\r\n.input-area-wrap {\r\n    display: flex;\r\n    flex-direction: column;\r\n    border-top: 1px solid #eee;\r\n    background: #fff;\r\n    position: relative;\r\n}\r\n\r\n.input-actions-top {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    padding: 4px 0 0 0;\r\n    margin-left: 2px;\r\n    margin-bottom: 2px;\r\n    gap: 4px;\r\n}\r\n\r\n.input-area {\r\n    display: flex;\r\n    padding: 12px 0 2px 0;\r\n    background: #fff;\r\n    align-items: flex-end;\r\n}\r\n\r\n.input-action-btn {\r\n\r\n    background: none;\r\n    border: none;\r\n    font-size: 22px;\r\n    cursor: pointer;\r\n    padding: 4px 6px;\r\n    border-radius: 4px;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.input-action-btn:hover {\r\n    background: #e6f7ff;\r\n}\r\n\r\n.input-area .msg-textarea {\r\n    flex: 1;\r\n    padding: 8px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n    margin-right: 8px;\r\n    min-width: 0;\r\n    min-height: 100px;\r\n    max-height: 200px;\r\n    resize: none;\r\n    font-size: 16px;\r\n    line-height: 1.5;\r\n    overflow-y: auto;\r\n    box-sizing: border-box;\r\n    transition: height 0.2s;\r\n}\r\n\r\n.input-area button {\r\n    padding: 8px 24px;\r\n    border: none;\r\n    background: #42b983;\r\n    color: #fff;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    white-space: nowrap;\r\n    height: 40px;\r\n    align-self: flex-end;\r\n    position: absolute;\r\n    right: 16px;\r\n    bottom: 12px;\r\n    height: 40px;\r\n    padding: 8px 20px;\r\n    margin: 0;\r\n\r\n}\r\n\r\n.input-area button:hover {\r\n    background: #369870;\r\n}\r\n\r\n.ws-status {\r\n    color: #f00;\r\n    text-align: center;\r\n    padding: 8px;\r\n}\r\n\r\n.nav-item.active {\r\n    background: #e6f7ff;\r\n    color: #42b983;\r\n}\r\n\r\n.emoji-panel {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    background: #fff;\r\n    border: 1px solid #eee;\r\n    border-radius: 8px;\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\r\n    padding: 8px 8px 0 8px;\r\n    margin-bottom: 4px;\r\n    max-width: 420px;\r\n    max-height: 180px;\r\n    overflow-y: auto;\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: 0;\r\n    bottom: 60px;\r\n}\r\n\r\n.emoji-item {\r\n    font-size: 22px;\r\n    padding: 4px 6px;\r\n    margin: 2px;\r\n    cursor: pointer;\r\n    border-radius: 4px;\r\n    transition: background 0.15s;\r\n}\r\n\r\n.emoji-item:hover {\r\n    background: #e6f7ff;\r\n}\r\n\r\n/* 图片预览模态框样式 */\r\n.image-preview-modal {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.8);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 1000;\r\n}\r\n\r\n.image-preview-container {\r\n    position: relative;\r\n    max-width: 90%;\r\n    max-height: 90%;\r\n}\r\n\r\n.preview-image {\r\n    max-width: 100%;\r\n    max-height: 100%;\r\n    border-radius: 8px;\r\n}\r\n\r\n/* 视频预览模态框样式 */\r\n.video-preview-modal {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.8);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 1000;\r\n}\r\n\r\n.video-preview-container {\r\n    position: relative;\r\n    max-width: 90%;\r\n    max-height: 90%;\r\n}\r\n\r\n.preview-video {\r\n    max-width: 50%;\r\n    max-height: 100%;\r\n    border-radius: 8px;\r\n}\r\n\r\n/* 关闭按钮样式 */\r\n.close-preview-btn {\r\n    position: absolute;\r\n    top: -40px;\r\n    right: 0;\r\n    background: rgba(255, 255, 255, 0.8);\r\n    border: none;\r\n    border-radius: 50%;\r\n    width: 32px;\r\n    height: 32px;\r\n    font-size: 20px;\r\n    cursor: pointer;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    transition: background 0.2s;\r\n}\r\n\r\n.close-preview-btn:hover {\r\n    background: rgba(255, 255, 255, 1);\r\n}\r\n</style>","import script from \"./MessageLayout.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./MessageLayout.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./MessageLayout.vue?vue&type=style&index=0&id=805c1e7e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-805c1e7e\"]])\n\nexport default __exports__","<template>\r\n   <div class=\"chat-layout\">\r\n     <!-- 侧边栏布局 -->\r\n     <LeftLayout /> \r\n     <!-- 聊天布局 -->\r\n     <MessageLayout />\r\n   </div>\r\n</template>\r\n\r\n<script setup>\r\nimport LeftLayout from '@/components/chat2/LeftLayout.vue'\r\nimport MessageLayout from '@/components/chat2/MessageLayout.vue'\r\n</script>\r\n\r\n<style>\r\n.chat-layout {\r\n  display: flex;\r\n  height: 100vh;\r\n  background: #f5f5f5;\r\n  overflow: hidden;\r\n}\r\n</style>","import script from \"./Chat.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Chat.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Chat.vue?vue&type=style&index=0&id=30af61da&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n    <div class=\"login-bg\">\r\n      <div class=\"login-box\">\r\n        <div class=\"login-tabs\">\r\n          <div :class=\"['login-tab', {active: tab==='login'}]\" @click=\"tab='login'\">登录</div>\r\n          <div :class=\"['login-tab', {active: tab==='register'}]\" @click=\"tab='register'\">注册</div>\r\n        </div>\r\n        <form @submit.prevent=\"tab==='login' ? doLogin() : doRegister()\">\r\n          <div class=\"login-form-item\">\r\n            <input v-model=\"username\" placeholder=\"用户名\" required />\r\n          </div>\r\n          <div v-if=\"tab==='register'\" class=\"login-form-item\">\r\n            <input v-model=\"nickname\" placeholder=\"昵称\" required />\r\n          </div>\r\n          <div class=\"login-form-item\">\r\n            <input v-model=\"password\" type=\"password\" placeholder=\"密码\" required />\r\n          </div>\r\n          <div class=\"login-form-item\">\r\n            <button type=\"submit\" :disabled=\"loading\">{{ tab==='login' ? '登录' : '注册' }}</button>\r\n          </div>\r\n          <div v-if=\"errorMsg\" class=\"login-error\">{{ errorMsg }}</div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script setup>\r\n  import { ref } from 'vue'\r\n  import { useRouter } from 'vue-router'\r\n  \r\n  const tab = ref('login')\r\n  const username = ref('')\r\n  const password = ref('')\r\n  const nickname = ref('')\r\n  const loading = ref(false)\r\n  const errorMsg = ref('')\r\n  const router = useRouter()\r\n  \r\n  async function doLogin() {\r\n    errorMsg.value = ''\r\n    loading.value = true\r\n    try {\r\n      const resp = await fetch('http://62.234.192.227/v1/api/user/login', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username: username.value, password: password.value })\r\n      })\r\n      // 返回的数据\r\n      const data = await resp.json()\r\n      if (data.code === 200 && data.data && data.data.token) {\r\n        const sessionKey = getSessionKey(); // 获取session key\r\n        localStorage.setItem(`token_${sessionKey}`, data.data.token)\r\n        localStorage.setItem(`userinfo_${sessionKey}`, JSON.stringify(data.data.userinfo))\r\n        router.push({ path: '/chat', query: { session: sessionKey } }) \r\n      } else {\r\n        errorMsg.value = data.msg || '登录失败'\r\n      }\r\n    } catch (e) {\r\n      errorMsg.value = '网络错误'\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n  \r\n  async function doRegister() {\r\n    errorMsg.value = ''\r\n    loading.value = true\r\n    try {\r\n      const resp = await fetch('http://62.234.192.227/v1/api/user/register', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username: username.value, password: password.value, nickname: nickname.value })\r\n      })\r\n      const data = await resp.json()\r\n      if (data.code === 200) {\r\n        tab.value = 'login'\r\n        errorMsg.value = '注册成功，请登录'\r\n      } else {\r\n        errorMsg.value = data.data || '注册失败'\r\n      }\r\n    } catch (e) {\r\n      errorMsg.value = '网络错误'\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n  \r\n  function getSessionKey() {\r\n    // 从URL参数获取或生成随机session key\r\n    const urlParams = new URLSearchParams(window.location.search)\r\n    return urlParams.get('session') || Math.random().toString(36).substr(2, 9)\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .login-bg {\r\n    min-height: 100vh;\r\n    background: linear-gradient(120deg, #ffffff 0%, #ffffff 100%);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .login-box {\r\n    background: #fff;\r\n    border-radius: 12px;\r\n    box-shadow: 0 4px 24px rgba(0,0,0,0.08);\r\n    padding: 36px 32px 28px 32px;\r\n    min-width: 320px;\r\n    max-width: 90vw;\r\n  }\r\n  .login-tabs {\r\n    display: flex;\r\n    margin-bottom: 24px;\r\n  }\r\n  .login-tab {\r\n    flex: 1;\r\n    text-align: center;\r\n    font-size: 20px;\r\n    font-weight: bold;\r\n    color: #888;\r\n    padding: 8px 0;\r\n    cursor: pointer;\r\n    border-bottom: 2px solid transparent;\r\n    transition: color 0.2s, border 0.2s;\r\n  }\r\n  .login-tab.active {\r\n    color: #42b983;\r\n    border-bottom: 2px solid #42b983;\r\n  }\r\n  .login-form-item {\r\n    margin-bottom: 18px;\r\n  }\r\n  .login-form-item input {\r\n    width: 100%;\r\n    padding: 10px 12px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 6px;\r\n    font-size: 16px;\r\n    outline: none;\r\n    transition: border 0.2s;\r\n  }\r\n  .login-form-item input:focus {\r\n    border: 1.5px solid #42b983;\r\n  }\r\n  .login-form-item button {\r\n    width: 100%;\r\n    padding: 10px 0;\r\n    background: #42b983;\r\n    color: #fff;\r\n    border: none;\r\n    border-radius: 6px;\r\n    font-size: 18px;\r\n    font-weight: bold;\r\n    cursor: pointer;\r\n    transition: background 0.2s;\r\n  }\r\n  .login-form-item button:disabled {\r\n    background: #b2e2c7;\r\n    cursor: not-allowed;\r\n  }\r\n  .login-error {\r\n    color: #f00;\r\n    text-align: center;\r\n    margin-top: 8px;\r\n    font-size: 15px;\r\n  }\r\n  </style>","import script from \"./LoginRegister.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LoginRegister.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./LoginRegister.vue?vue&type=style&index=0&id=ce4b13ea&scoped=true&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-ce4b13ea\"]])\n\nexport default __exports__","import { createRouter, createWebHistory } from 'vue-router'\r\nimport Chat from './Chat.vue'\r\nimport LoginRegister from './LoginRegister.vue'\r\n\r\nconst routes = [\r\n  {\r\n    path: '/',\r\n    component: LoginRegister,\r\n  },\r\n  {\r\n    path: '/chat',\r\n    name: 'Chat', \r\n    component: Chat,\r\n    meta: { requiresAuth: true }\r\n  },\r\n  {\r\n    path: '/login',\r\n    name: 'Login',\r\n    component: LoginRegister\r\n  }\r\n]\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(),\r\n  routes\r\n})\r\n\r\n// 路由守卫：未登录跳转到登录页\r\nrouter.beforeEach((to, from, next) => {\r\n  // 从URL参数获取sessionKey\r\n  const sessionKey = to.query.session // 修改这里\r\n  // 根据sessionKey获取token\r\n  const token = sessionKey ? localStorage.getItem(`token_${sessionKey}`) : null\r\n  // console.log('当前路由:', to.path)\r\n  // console.log('sessionKey:', sessionKey)\r\n  // console.log('token:', token)\r\n  if (to.meta.requiresAuth && !token) {\r\n    next({ path: '/login' })\r\n  } else if (to.path === '/login' && token) {\r\n    next({ path: '/chat', query: { session: sessionKey } })\r\n  } else {\r\n    next()\r\n  }\r\n})\r\n\r\nexport default router\r\n","import { createApp } from 'vue'\r\nimport App from './App.vue'\r\nimport router from './router'\r\nimport './styles/themes.css'\r\n\r\ncreateApp(App).use(router).mount('#app')\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t524: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkchat_web\"] = self[\"webpackChunkchat_web\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [504], () => (__webpack_require__(7143)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["__exports__","toUuid","friends","groups","currentChatTargetName","currentChatID","chatMessages","hasUnreadMoments","showFriendRequest","friendRequestInfo","fromUsername","content","from","showFriendReplyRequest","friendResponseInfo","currentChatType","props","emit","visible","timer","showToast","value","clearTimeout","setTimeout","hideToast","duration","getIcon","icons","info","success","warning","error","type","show","newVal","class","message","route","sessionKey","query","session","userinfo","JSON","parse","localStorage","getItem","myName","nickname","myUuid","uuid","token","navTab","showAddFriend","newFriendName","searchResults","searching","searchError","showAddGroup","newGroupName","showCreateGroup","createGroupName","createGroupType","createGroupDescription","creatingGroup","joiningGroup","toastMessage","toastType","showSettings","settingsTab","currentTheme","autoTheme","eyeCareMode","updatingProfile","updatingPassword","profileForm","username","email","passwordForm","currentPassword","newPassword","confirmPassword","showAddMoment","newMomentContent","publishingMoment","moments","submittingComment","showToastMessage","handleNavClick","tab","getFriendList","getGroupList","getMomentList","async","searchFriend","name","trim","resp","fetch","encodeURIComponent","method","headers","ok","Error","data","json","e","addSearchedFriend","f","sendAddRequest","body","stringify","target_user_name","code","msg","then","push","cancelAddFriend","createGroup","description","group_name","group_type","console","log","group_id","unread","cancelCreateGroup","joinGroup","group_uuid","cancelAddGroup","selectFriend","friend","saveUnreadCounts","selectGroup","group","unreadCounts","forEach","setItem","handleFriendRequest","isAccept","status","target_uuid","handleFriendResponse","savedUnreadCounts","map","item","friend_nickname","friend_uuid","updateProfile","avatar","updatePassword","length","resetPasswordForm","resetProfileForm","setTheme","theme","applyTheme","toggleAutoTheme","toString","systemTheme","window","matchMedia","matches","toggleEyeCareMode","applyEyeCareMode","root","document","documentElement","setAttribute","classList","remove","add","setupThemeListener","mediaQuery","addEventListener","publishMoment","newMoment","id","Date","now","author","timestamp","toISOString","unshift","savedMoments","cancelAddMoment","moment_id","user_id","likes","like_count","comments","comment_list","create_time","formatTime","date","diff","Math","floor","toLocaleDateString","likeMoment","moment","momentId","parseInt","requestBody","toggleComments","showComments","newComment","getCommentList","submitComment","comment_id","viewBox","fill","role","xmlns","width","height","maskUnits","x","y","rx","mask","transform","d","stroke","placeholder","disabled","key","endsWith","src","alt","style","startsWith","avatarType","maxlength","comment","formatFileSize","bytes","units","size","unitIndex","toFixed","emojiList","ws","wsConnected","initWebSocket","onMessageCallback","MessageType","WS_URL","WebSocket","binaryType","onopen","setInterval","readyState","OPEN","msgObj","to","messageType","errMsg","verify","messageBuffer","encode","create","finish","send","onclose","onmessage","getWebSocket","closeWebSocket","close","showCallInterface","callState","callerName","targetName","targetUuid","isMuted","isSpeakerOn","callDuration","callTimer","localStream","remoteStream","peerConnection","rtcConfiguration","iceServers","urls","formatCallDuration","minutes","seconds","padStart","initWebRTC","navigator","mediaDevices","getUserMedia","audio","video","RTCPeerConnection","getTracks","track","addTrack","ontrack","event","streams","playRemoteAudio","onicecandidate","candidate","sendSignalingMessage","onconnectionstatechange","connectionState","startCallTimer","endCall","alert","startCall","fromName","acceptCall","rejectCall","hangUp","clearInterval","stop","toggleMute","audioTrack","getAudioTracks","enabled","toggleSpeaker","audioElement","Audio","srcObject","play","catch","contentType","url","fileSuffix","file","Uint8Array","handleSignalingMessage","signalData","createOffer","handleOffer","offer","handleAnswer","answer","handleIceCandidate","setLocalDescription","setRemoteDescription","createAnswer","addIceCandidate","isVideoEnabled","isLocalVideoMinimized","hasMultipleCameras","currentCameraIndex","availableCameras","localVideo","remoteVideo","getAvailableCameras","devices","enumerateDevices","filter","device","kind","constraints","ideal","frameRate","facingMode","playRemoteVideo","toggleVideo","videoTrack","getVideoTracks","switchCamera","selectedCamera","newVideoStream","deviceId","exact","newVideoTrack","sender","getSenders","find","s","replaceTrack","MediaStream","toggleLocalVideoSize","ref","autoplay","playsinline","muted","title","ACKManager","constructor","this","pendingAcks","Set","ackTimer","ackDelay","messageObserver","visibilityObserver","messageElements","Map","readMessages","init","setupIntersectionObserver","setupVisibilityObserver","options","rootMargin","threshold","IntersectionObserver","entries","entry","isIntersecting","messageId","target","dataset","fromUuid","markMessageAsRead","hidden","flushPendingAcks","registerMessageElement","element","set","observe","unregisterMessageElement","get","unobserve","delete","has","scheduleAckSend","ackMessageIds","Array","ackMessage","isFragmented","fragmentIndex","totalFragments","checksum","isRead","readTimestamp","clear","markChatAsRead","chatId","messages","isMessageRead","handleAckMessage","CustomEvent","detail","messageIds","dispatchEvent","destroy","disconnect","removeEventListener","ackManager","input","currentChatName","fileInput","isRecording","mediaRecorder","audioChunks","audioBlob","showEmojiPanel","emojiPanelRef","showImagePreview","showVideoPreview","previewImageUrl","previewVideoUrl","voiceCallRef","videoCallRef","messagesContainer","readMessageIds","showTypingIndicator","typingUser","typingTimer","handleFileSelect","files","reader","FileReader","onload","fileBuffer","result","fileName","suffix","split","pop","sendFileMessage","readAsArrayBuffer","fileData","imageExtensions","videoExtensions","includes","toLowerCase","URL","createObjectURL","Blob","generateMessageId","toggleRecording","stream","MediaRecorder","ondataavailable","onstop","arrayBuffer","sendVoiceMessage","audioBuffer","round","start","voiceData","formatDuration","mins","secs","String","lookup","handleWebSocketMessage","handleMessagesAcked","fragmentManager","buffer","decodedBuffer","decode","decoded","completeMessage","handleFragmentedMessage","isPrivateMessage","handleTextMessage","handleFileMessage","handleImageMessage","handleAudioMessage","handleVideoMessage","handleWebRTCSignaling","handleWebRTCVideoSignaling","fragment","fragments","receivedCount","messageInfo","warn","reassembleMessage","sort","a","b","totalSize","serializedData","offset","originalMessage","updateUnreadCount","addMessageToChat","getMimeType","getType","startVoiceCall","startVideoCall","onVoiceCallStarted","onVoiceCallEnded","onVideoCallStarted","onVideoCallEnded","targetCollection","targetUpdate","mimeTypes","ts","toLocaleTimeString","handleInputChange","showTypingIndicatorDemo","hideTypingIndicator","sendMessage","showNotImpl","toggleEmojiPanel","handleClickOutside","contains","insertEmoji","emoji","previewImage","closeImagePreview","previewVideo","closeVideoPreview","random","substr","el","timeout","newUuid","oldUuid","currentMessages","idx","href","download","controls","$refs","click","rows","password","loading","errorMsg","router","doLogin","getSessionKey","path","doRegister","urlParams","URLSearchParams","location","search","required","routes","component","LoginRegister","Chat","meta","requiresAuth","history","beforeEach","next","App","use","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call","m","deferred","O","chunkIds","fn","priority","notFulfilled","Infinity","i","fulfilled","j","Object","keys","every","splice","r","n","getter","__esModule","definition","o","defineProperty","enumerable","g","globalThis","Function","obj","prop","prototype","hasOwnProperty","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","bind","__webpack_exports__"],"sourceRoot":""}